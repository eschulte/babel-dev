---
title: DONE Handling of table column names and hlines across languages 
layout: default
---

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="done DONE"> DONE</span> Handling of table column names and hlines across languages </h2>
<div class="outline-text-2" id="text-1">

<ul>
<li>
State "DONE"       from "TODO" <span class="timestamp-wrapper"> <span class="timestamp">2010-04-23 Fri 09:42</span></span>
</li>
<li>
State "TODO"       from "PROPOSED" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-26 Fri 21:38</span></span>
</li>
<li>
State "PROPOSED"   from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-02-23 Tue 20:04</span></span>
</li>
<li>
State "TODO"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-02-23 Tue 12:22</span></span>

</li>
</ul>

<p>Org-babel now supports three new header arguments, and new default
behavior for handling horizontal lines in tables (hlines), column
names, and rownames across all languages.  These are as follows
</p>
<dl>
<dt><code>:hlines</code></dt><dd>
Can take on the values of "yes" or "no", with a default
value of "no".  These values have the following effects.

<dl>
<dt>"no"</dt><dd>
results in all hlines being stripped from the input
table.  In most languages this is the desired effect, as a
raw 'hline symbol generally is interpreted as an unbound
variable and leads to and error.  The following table would
previously have lead to an error but is now processed as
shown.

<pre class="example">
#+tblname: many-cols
| a | b | c |
|---+---+---|
| d | e | f |
|---+---+---|
| g | h | i |

#+source: echo-table
#+begin_src python :var tab=many-cols
  return tab
#+end_src

#+results: echo-table
| a | b | c |
| d | e | f |
| g | h | i |
</pre>


</dd>
<dt>"yes"</dt><dd>
leaves 'hlines in the table. This is the default for
emacs-lisp which may want to handle hline symbols
explicitly.

</dd>
</dl>
</dd>
<dt><code>:colnames</code></dt><dd>
Can take on the values of "yes", "no", or <code>nil</code> for
unassigned.  The default value is <code>nil</code>.  These values have the
following effects

<dl>
<dt><code>nil</code></dt><dd>
If an input table <i>looks like</i> it has column names
(meaning if it's second row is an hline), then the column
names will be removed from the table by org-babel before
processing, then reapplied to the results, so for example
the following code block has the effect shown.

<pre class="example">
#+tblname: less-cols
| a |
|---|
| b |
| c |
  
#+srcname: echo-table-again
#+begin_src python :var tab=less-cols
  return [[val + '*' for val in row] for row in tab]
#+end_src

#+results: echo-table-again
| a  |
|----|
| b* |
| c* |
</pre>


</dd>
<dt>"no"</dt><dd>
No column name pre-processing will take place.

</dd>
<dt>"yes"</dt><dd>
Column names are removed and reapplied as with <code>nil</code>
even if the table does not look like it has column names
(i.e. the second row is not an hline)

</dd>
</dl>
</dd>
<dt><code>:rownames</code></dt><dd>
Can take on the values of "yes" or "no", with a
default value of "no".  These values have the following effects.

<dl>
<dt>"no"</dt><dd>
No row name pre-processing will take place.

</dd>
<dt>"yes"</dt><dd>
The first column of the table is removed from the
table by org-babel before processing, and is then reapplied
to the results.  This has the effect shown below.

<pre class="example">
#+tblname: with-rownames
| one | 1 | 2 | 3 | 4 |  5 |
| two | 6 | 7 | 8 | 9 | 10 | 

#+srcname: echo-table-once-again
#+begin_src python :var tab=with-rownames :rownames yes
  return [[val + 10 for val in row] for row in tab]            
#+end_src

#+results: echo-table-once-again
| one | 11 | 12 | 13 | 14 | 15 |
| two | 16 | 17 | 18 | 19 | 20 |
</pre>


</dd>
</dl>
</dd>
</dl>


<p>
Thanks to Julien Barnier for adding rownames support in R.
</p>


</div>

<div id="outline-container-1_1" class="outline-3">
<h3 id="sec-1_1">discussion </h3>
<div class="outline-text-3" id="text-1_1">

<p>See also <a href="#*Support==rownames==and==other==org==babel==table==features">Support rownames and other org babel table features?</a>
</p>
<p>
Julien Barnier has made a patch implementing rownames in R. This
is in branch julien-barnier-R-rownames in the devel repo (commit
f29c00432e6091bc1fbce8d1eb9052eff61da7b7)
</p>
<p>
There is a test file for column and rownames <a href="http:col-row-names.html">here</a>.
</p>

</div>

<div id="outline-container-1_1_1" class="outline-4">
<h4 id="sec-1_1_1">From Tom Dye </h4>
<div class="outline-text-4" id="text-1_1_1">

<blockquote>

<p>IIUC, the difficulty is introduced by the difference between R, which
keeps row names "under the hood," and org-mode, which doesn't have a
concept of row names.  So, the question becomes one of preserving R's
row names in cases where that is desirable.  Because it is not
possible, AFAIK, to distinguish between an org-mode table created
through an R call to print a data frame and one made with org-tbl, the
onus is on the user to preserve R row names
</p>
<p>
One way would be to establish an idiom for exporting and importing R
data frames and put it on Worg.  This one works for me.
</p>
<p>
So, on the way out:
cbind(row=rownames(df),df)
</p>
<p>
And, on the way in:
df &lt;- data.frame(x, row.names=1)
</p>
<p>
If you want, I can add this, or something like it, to org-babel-doc-R.
</p>
<p>
Also, I've been using the reshape package and a melt, cast sequence,
which I use frequently, keeps the row names in the first column, so I
only have to be conscious of preserving row names on the way back into
org-mode.
</p>
</blockquote>


</div>

</div>

<div id="outline-container-1_1_2" class="outline-4">
<h4 id="sec-1_1_2">Examples </h4>
<div class="outline-text-4" id="text-1_1_2">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" />
</colgroup>
<thead>
<tr><th scope="col">Date</th><th scope="col">Kg</th></tr>
</thead>
<tbody>
<tr><td>2010-02-21</td><td>95.0</td></tr>
<tr><td>2010-02-22</td><td>93.0</td></tr>
<tr><td>2010-02-23</td><td>92.0</td></tr>
<tr><td>2010-02-24</td><td>91.5</td></tr>
<tr><td>2010-02-25</td><td>91.0</td></tr>
<tr><td>2010-02-26</td><td>92.0</td></tr>
</tbody>
</table>


<p>
As things stand
</p>
</div>

</div>

<div id="outline-container-1_1_3" class="outline-4">
<h4 id="sec-1_1_3">python </h4>
<div class="outline-text-4" id="text-1_1_3">




<pre class="src src-python"><span class="org-keyword">return</span> d
</pre>



<p>
Results in error because of 'hline
</p>
<p>
We could remove the hline with the following, but need to think about whether to include the column names or not.
</p>



<pre class="src src-emacs-lisp"><span class="org-esk-paren">(</span><span class="org-keyword">defun</span> <span class="org-function-name">org-babel-python-var-to-python</span> <span class="org-esk-paren">(</span>var<span class="org-esk-paren">)</span>
  <span class="org-doc">"Convert an elisp var into a string of python source code
specifying a var of the same value."</span>
  <span class="org-esk-paren">(</span><span class="org-keyword">if</span> <span class="org-esk-paren">(</span>listp var<span class="org-esk-paren">)</span>
      <span class="org-esk-paren">(</span>concat <span class="org-string">"["</span> <span class="org-esk-paren">(</span>mapconcat #'org-babel-python-var-to-python <span class="org-esk-paren">(</span>remq 'hline var<span class="org-esk-paren">)</span> <span class="org-string">", "</span><span class="org-esk-paren">)</span> <span class="org-string">"]"</span><span class="org-esk-paren">)</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(concat "[" (mapconcat #'org-babel-python-var-to-python var ", ") "]")
</span>    <span class="org-esk-paren">(</span>format <span class="org-string">"%S"</span> var<span class="org-esk-paren">)))</span>
</pre>



<p>
That change would give this as result:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" />
</colgroup>
<tbody>
<tr><td>Date</td><td>Kg</td></tr>
<tr><td>2010-02-21</td><td>95.0</td></tr>
<tr><td>2010-02-22</td><td>93.0</td></tr>
<tr><td>2010-02-23</td><td>92.0</td></tr>
<tr><td>2010-02-24</td><td>91.5</td></tr>
<tr><td>2010-02-25</td><td>91.0</td></tr>
<tr><td>2010-02-26</td><td>92.0</td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-1_1_4" class="outline-4">
<h4 id="sec-1_1_4">R </h4>
<div class="outline-text-4" id="text-1_1_4">




<pre class="src src-R">d
</pre>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">Date</th><th scope="col">Kg</th></tr>
</thead>
<tbody>
<tr><td>2010-02-21</td><td>95.0</td></tr>
</tbody>
</table>


<p>
NB Is it unfortunate that a named simple vector doesn't get its names
printed out with :colnames yes?
</p>



<pre class="src src-R">c(a=1,b=2)
</pre>




<p>
This is because a 1d vector gets turned into a table with one column,
and hence its names would be rownames, not column names. One has to
transpose the vector in R to get the desired result.
</p>



<pre class="src src-R">t(c(a=1,b=2))
</pre>




</div>

</div>

<div id="outline-container-1_1_5" class="outline-4">
<h4 id="sec-1_1_5">shell </h4>
<div class="outline-text-4" id="text-1_1_5">




<pre class="src src-sh"><span class="org-builtin">echo</span> $<span class="org-variable-name">d</span>
</pre>



<p>
Error:
</p>
<p>
org-babel-sh-var-to-sh wrongly converts 'hline into "hline" resulting
in error in orgtbl-to-generic. Could change last loine of org-babel-sh-var-to-sh
</p>
<p>
(if (stringp var) (format "%s" var) (format "%S" var))))
</p>
<p>
to
</p>
<p>
(cond
((eq var 'hline) var)
((stringp var) (format "%s" var))
(t (format "%S" var)))
</p>
<p>
But need to think about whether the hline should even be there at this
stage, or whether hlines and column names should have been removed (at
least hlines as 2nd element of elisp table).
</p></div>
</div>
</div>
</div>
