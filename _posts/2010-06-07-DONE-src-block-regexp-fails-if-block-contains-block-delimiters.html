---
title: DONE src block regexp fails if block contains block delimiters
layout: default
---

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="done DONE"> DONE</span> src block regexp fails if block contains block delimiters </h2>
<div class="outline-text-2" id="text-1">

<ul>
<li>
State "DONE"       from "TODO" <span class="timestamp-wrapper"> <span class="timestamp">2010-06-07 Mon 16:23</span></span>
</li>
<li>
State "TODO"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-11 Thu 11:32</span></span>

</li>
</ul>

<p>this appears to be fixed now&hellip;
</p>



<div class="org-src-container"><label class="org-src-name">source-block-in-source-block()</label><pre class="src src-emacs-lisp">
(concat <span class="org-string">"#+begin_src\n"</span>
        <span class="org-string">"hello\n"</span>
        <span class="org-string">"#+end_src\n"</span>)
</pre></div>




<p>
used to be that C-c C-c \rightarrow End of file during parsing
</p>

</div>

<div id="outline-container-1_1" class="outline-3">
<h3 id="sec-1_1">report by Maurizio Vitale </h3>
<div class="outline-text-3" id="text-1_1">

<pre class="example">
From: Maurizio Vitale &lt;mav@cuma.i-did-not-set--mail-host-address--so-tickle-me&gt;
Subject: [Orgmode] Re: [babel] problems with org-babel-src-block-regexp (full text)
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.1.50 (gnu/linux)
Date: Thu, 11 Mar 2010 12:19:09 -0500
To: emacs-orgmode@gnu.org


[sorry for the double posting, but the control char in the regexp
prevented the full message from appearing. This is what I meant to send]

There're problems with org-babel-src-block-regexp when the src block
contains the block delimiters (for instance in strings or comments).

Granted, this is an uncommon occurrence (which I discovered by accident)
editing an org-file containing elisp code that needed to insert
#+begin_src...#+end_src pairs, but if it is not too difficult to fix it
would be nice to have a more useful behaviour.

This is my setting (replaced 0x0 with ^@ to avoid posting problems):
org-babel-src-block-regexp is a variable defined in `org-babel.el'.
Its value is 
"^[   ]*#\\+begin_src[        ]+\\(python\\|sh\\|emacs-lisp\\)[       ]*\\([^\":\n]*\"[^\"\n*]*\"[^\":\n]*\\|[^\":\n]*\\)\\([^\n]*\\)\n\\([^^@]+?\\)#\\+end_src"

And these are two test cases. I'm particularly puzzled by the first,
because the regexp seems to be anchored to the begin of line and hence
it shouldn't match the begin_src inside the string.
For end_src, it should probably be anchored to the begin of line.

#+begin_src emacs-lisp
;;; evaluating the following C-x C-e with the point at the end is ok
(org-babel-where-is-src-block-head)
(defun foo () (insert "#+begin_src emacs-lisp"))
;;; evaluating the following C-x C-e with the point at the end is not ok
(org-babel-where-is-src-block-head)
#+end_src

#+begin_src emacs-lisp
;;; evaluating the following C-x C-e with the point at the end is ok
(org-babel-where-is-src-block-head)
(defun foo () (insert "#+end_src emacs-lisp"))
;;; evaluating the following C-x C-e with the point at the end is not ok
(org-babel-where-is-src-block-head)
#+end_src

Best regards,

     Maurizio 
</pre>

</div>
</div>
</div>
