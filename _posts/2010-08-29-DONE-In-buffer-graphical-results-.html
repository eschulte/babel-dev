---
title: DONE In-buffer graphical results 
layout: default
---

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="done DONE"> DONE</span> In-buffer graphical results </h2>
<div class="outline-text-2" id="text-1">

<ul>
<li>
State "DONE"       from "STARTED" <span class="timestamp-wrapper"> <span class="timestamp">2010-08-29 Sun 19:00</span></span>
</li>
<li>
State "STARTED"    from "PROPOSED" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-15 Mon 17:21</span></span>
</li>
<li>
State "PROPOSED"   from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-15 Mon 17:15</span></span>

<p>
This functionality was implemented by Carsten. See
`org-toggle-inline-images'.
</p>
<p>
A proof-of-principle implementation of this is below. It uses
org-babel-after-execute-hook to refresh the inline image displays
in the whole buffer. This means that the code for plots and latex
fragments can be edited and then the graphic updated with C-c
C-c.
</p>
<p>
However, after looking briefly at Nicolas Girard's work on
org-icons.el, I wonder whether it would be nicer to implement
this using the font-lock machinery, similar to how the org icons
are implemented.
</p>
</li>
</ul>




<pre class="src src-emacs-lisp"><span class="org-esk-paren">(</span><span class="org-keyword">defun</span> <span class="org-function-name">ded/iimage-mode-buffer</span> <span class="org-esk-paren">(</span>arg <span class="org-type">&amp;optional</span> refresh<span class="org-esk-paren">)</span>
<span class="org-doc">"Display/undisplay images.
With numeric ARG, display the images if and only if ARG is positive."</span>
  <span class="org-esk-paren">(</span>interactive<span class="org-esk-paren">)</span>
  <span class="org-esk-paren">(</span><span class="org-keyword">let</span> <span class="org-esk-paren">((</span>ing <span class="org-esk-paren">(</span><span class="org-keyword">if</span> <span class="org-esk-paren">(</span>numberp arg<span class="org-esk-paren">)</span>
                 <span class="org-esk-paren">(</span>&gt; arg 0<span class="org-esk-paren">)</span>
               iimage-mode<span class="org-esk-paren">))</span>
        <span class="org-esk-paren">(</span>modp <span class="org-esk-paren">(</span>buffer-modified-p <span class="org-esk-paren">(</span>current-buffer<span class="org-esk-paren">)))</span>
        file img<span class="org-esk-paren">)</span>
    <span class="org-esk-paren">(</span><span class="org-keyword">save-excursion</span>
      <span class="org-esk-paren">(</span>goto-char <span class="org-esk-paren">(</span>point-min<span class="org-esk-paren">))</span>
      <span class="org-esk-paren">(</span><span class="org-keyword">dolist</span> <span class="org-esk-paren">(</span>pair iimage-mode-image-regex-alist<span class="org-esk-paren">)</span>
        <span class="org-esk-paren">(</span><span class="org-keyword">while</span> <span class="org-esk-paren">(</span>re-search-forward <span class="org-esk-paren">(</span>car pair<span class="org-esk-paren">)</span> nil t<span class="org-esk-paren">)</span>
          <span class="org-esk-paren">(</span><span class="org-keyword">if</span> <span class="org-esk-paren">(</span>and <span class="org-esk-paren">(</span>setq file <span class="org-esk-paren">(</span>match-string <span class="org-esk-paren">(</span>cdr pair<span class="org-esk-paren">)))</span>
                   <span class="org-esk-paren">(</span>setq file <span class="org-esk-paren">(</span>iimage-locate-file file
                                   <span class="org-esk-paren">(</span>cons default-directory
                                         iimage-mode-image-search-path<span class="org-esk-paren">))))</span>
              <span class="org-esk-paren">(</span><span class="org-keyword">if</span> ing
                  <span class="org-esk-paren">(</span><span class="org-keyword">let</span> <span class="org-esk-paren">((</span>img <span class="org-esk-paren">(</span>create-image file<span class="org-esk-paren">)))</span>
                    <span class="org-esk-paren">(</span>add-text-properties <span class="org-esk-paren">(</span>match-beginning 0<span class="org-esk-paren">)</span> <span class="org-esk-paren">(</span>match-end 0<span class="org-esk-paren">)</span> <span class="org-esk-paren">(</span>list 'display img<span class="org-esk-paren">))</span>
                    <span class="org-esk-paren">(</span><span class="org-keyword">if</span> refresh <span class="org-esk-paren">(</span>image-refresh img<span class="org-esk-paren">)))</span>
                <span class="org-esk-paren">(</span>remove-text-properties <span class="org-esk-paren">(</span>match-beginning 0<span class="org-esk-paren">)</span> <span class="org-esk-paren">(</span>match-end 0<span class="org-esk-paren">)</span> '<span class="org-esk-paren">(</span>display<span class="org-esk-paren">)))))))</span>
    <span class="org-esk-paren">(</span>set-buffer-modified-p modp<span class="org-esk-paren">)))</span>

<span class="org-esk-paren">(</span><span class="org-keyword">defun</span> <span class="org-function-name">ded/org-iimage-refresh</span> <span class="org-esk-paren">()</span>
  <span class="org-esk-paren">(</span>interactive<span class="org-esk-paren">)</span>
  <span class="org-esk-paren">(</span>redisplay t<span class="org-esk-paren">)</span>
  <span class="org-esk-paren">(</span>set-face-underline-p 'org-link nil<span class="org-esk-paren">)</span>
  <span class="org-esk-paren">(</span>ded/iimage-mode-buffer 1 'refresh<span class="org-esk-paren">)</span>
  <span class="org-esk-paren">(</span>redisplay t<span class="org-esk-paren">))</span>

<span class="org-esk-paren">(</span>add-hook 'org-babel-after-execute-hook 'ded/org-iimage-refresh<span class="org-esk-paren">)</span>
</pre>



</div>
</div>
