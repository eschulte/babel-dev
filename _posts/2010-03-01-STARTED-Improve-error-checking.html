---
title: STARTED Improve error checking
layout: default
---

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="todo STARTED"> STARTED</span> Improve error checking </h2>
<div class="outline-text-2" id="text-1">

<ul>
<li>
State "STARTED"    from "TODO" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-01 Mon 10:00</span></span>
</li>
<li>
State "TODO"       from "DEFERRED" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-01 Mon 05:49</span></span>

<p>
Current solution for :results value mode:
</p><ul>
<li>
store shell exit code and stderr
</li>
<li>
if non-zero exit code:
<ul>
<li>
write stderr to <b>Org-Babel Error Output</b>
</li>
<li>
display <b>Org-Babel Error Output</b>

</li>
</ul>
</li>
</ul>

<p>:results output mixes stderr with stdout and does not otherwise notify on error.
</p>
<p>
Questions:
</p><ul>
<li>
What should we do when stderr is non-empty but exit code is
zero?
</li>
<li>
What should we do in the case of shell non-session :results value?
</li>
<li>
What should we do in the case of :session?

</li>
</ul>
</li>
</ul>

</div>

<div id="outline-container-1.1" class="outline-3">
<h3 id="sec-1.1">Return error structure? </h3>
<div class="outline-text-3" id="text-1.1">

<p>Could use the following at outset of org-babel-insert-result.
</p>


<pre class="src src-emacs-lisp"><span class="org-esk-paren">(</span><span class="org-keyword">if</span> <span class="org-esk-paren">(</span>and <span class="org-esk-paren">(</span>consp result<span class="org-esk-paren">)</span> <span class="org-esk-paren">(</span>eq <span class="org-esk-paren">(</span>first result 'org-babel-error-flag<span class="org-esk-paren">)))</span>
    <span class="org-esk-paren">(</span><span class="org-keyword">progn</span>
      <span class="org-esk-paren">(</span>message <span class="org-string">"Shell command exited with error %d"</span> <span class="org-esk-paren">(</span>second result<span class="org-esk-paren">))</span>
      <span class="org-esk-paren">(</span><span class="org-keyword">unless</span> <span class="org-esk-paren">(</span>= <span class="org-esk-paren">(</span>length <span class="org-esk-paren">(</span>third result<span class="org-esk-paren">))</span> 0<span class="org-esk-paren">)</span>
        <span class="org-esk-paren">(</span><span class="org-keyword">let</span> <span class="org-esk-paren">(</span>error-buffer <span class="org-esk-paren">(</span>get-buffer-create <span class="org-string">"*Org-Babel Error Output"</span><span class="org-esk-paren">))</span>
          <span class="org-esk-paren">(</span><span class="org-keyword">with-current-buffer</span> error-buffer <span class="org-esk-paren">(</span>insert <span class="org-esk-paren">(</span>third result<span class="org-esk-paren">)))</span>
          <span class="org-esk-paren">(</span>display-buffer error-buffer<span class="org-esk-paren">)))))</span>
</pre>




</div>

</div>

<div id="outline-container-1.2" class="outline-3">
<h3 id="sec-1.2">older notes </h3>
<div class="outline-text-3" id="text-1.2">

<p>E.g. when trying to execute sass block, I did not have sass
installed, and so shell-command returned code 127, but org-babel
did not warn me that anything had gone wrong.
I expect it will be hard to do this properly, but ultimately it
would be nice to be able to specify somewhere to receive STDERR,
and to be warned if it is non-empty.
</p>
<p>
Probably simpler in non-session evaluation than session? At least
the mechanism will be different I guess.
</p>
<p>
R has a try function, with error handling, along the lines of
python. I bet ruby does too. Maybe more of an issue for functional
style; in my proposed scripting style the error just gets dumped to
the org buffer and the user is thus alerted.
</p>
<p>
For now I think the current behavior of returning any error
messages generated by the source language is sufficient.
</p>
</div>

</div>

<div id="outline-container-1.3" class="outline-3">
<h3 id="sec-1.3">Error checking in R sessions </h3>
<div class="outline-text-3" id="text-1.3">

<p>A simple thing to do is to wrap the R code in try(&hellip;), as in the
patch below. That results in some improved behaviour:
</p><ul>
<li>
You get the error message from R
</li>
<li>
Execution halts at first error
E.g.

</li>
</ul>


<pre class="src src-R"><span class="org-function-name">f</span> <span class="org-constant">&lt;-</span> <span class="org-keyword">function</span>() {
    cat(<span class="org-string">"hello\n"</span>)
    x <span class="org-constant">&lt;-</span> log(<span class="org-string">"a"</span>)
    cat(<span class="org-string">"bye\n"</span>)
}
</pre>





<pre class="src src-R">f()
</pre>




<pre class="example">
+ hello
Error in log("a") : Non-numeric argument to mathematical function
</pre>



</div>

<div id="outline-container-1.3.1" class="outline-4">
<h4 id="sec-1.3.1">patch </h4>
<div class="outline-text-4" id="text-1.3.1">

<p>diff &ndash;git a/contrib/babel/lisp/langs/org-babel-R.el b/contrib/babel/lisp/langs/org-babel-R.el
index 1ef21db..45f8409 100644
&mdash; a/contrib/babel/lisp/langs/org-babel-R.el
+++ b/contrib/babel/lisp/langs/org-babel-R.el
@@ -103,8 +103,8 @@ last statement in BODY, as elisp."
(out-tmp-file (make-temp-file "R-out-functional-results")))
(case result-type
(output
</p><ul>
<li>
          (with-temp-file in-tmp-file (insert body))
</li>
<li>
          (shell-command-to-string (format "R &ndash;slave &ndash;no-save &lt; '%s' &gt; '%s'"
</li>
<li>
          (with-temp-file in-tmp-file (insert (concat "try({" body "})")))
</li>
<li>
          (shell-command-to-string (format "R &ndash;slave &ndash;no-save &lt; '%s' &gt; '%s' 2&gt;&amp;1"
in-tmp-file out-tmp-file))
(with-temp-buffer (insert-file-contents out-tmp-file) (buffer-string)))
(value
</li>
</ul>

<p>@@ -124,7 +124,7 @@ last statement in BODY, as elisp."
(format "write.table(.Last.value, file=\"%s\", sep=\"\\t\", na=\"nil\",row.names=FALSE, col.names=%s, quote=FALSE)" tmp-file (if column-names-p "TRUE" "FALSE"))
org-babel-R-eoe-indicator) "\n"))
(output
</p><ul>
<li>
               (mapconcat #'org-babel-chomp (list body org-babel-R-eoe-indicator) "\n"))))
</li>
<li>
               (mapconcat #'org-babel-chomp (list (concat "try({" body "})") org-babel-R-eoe-indicator) "\n"))))
(raw (org-babel-comint-with-output buffer org-babel-R-eoe-output nil
(insert full-body) (inferior-ess-send-input)))
broke results)
</li>
</ul>

<p>diff &ndash;git a/contrib/babel/lisp/org-babel-ref.el b/contrib/babel/lisp/org-babel-ref.el
index 0e8695f..060f880 100644
&mdash; a/contrib/babel/lisp/org-babel-ref.el
+++ b/contrib/babel/lisp/org-babel-ref.el
@@ -139,7 +139,7 @@ return nil."
('results-line (org-babel-read-result))
('table (org-babel-read-table))
('source-block
</p><ul>
<li>
        (setq result (org-babel-execute-src-block t nil args))
</li>
<li>
        (setq result (org-babel-execute-src-block t (org-babel-get-src-block-info) args))
(if (symbolp result) (format "%S" result) result))
('lob (setq result (org-babel-execute-src-block t lob-info args)))))))

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-1.4" class="outline-3">
<h3 id="sec-1.4"><span class="todo TODO"> TODO</span> Finalise argument-passing syntax </h3>
<div class="outline-text-3" id="text-1.4">





<div class="org-src-container"><label class="org-src-name">unnamedargs(x=7)</label><pre class="src src-python">
x
</pre></div>







<label class="org-src-name">unnamedargs(5)</label>


: 7

<p>
In general we need to have a full set of rules for how a string
of supplied arguments (some possibly named) interact with the
arguments in the definition (some possibly with defaults) to give
values to the variables in the function body.
</p></div>

</div>

<div id="outline-container-1.5" class="outline-3">
<h3 id="sec-1.5"><span class="todo STARTED"> STARTED</span> share org-babel [3/7] </h3>
<div class="outline-text-3" id="text-1.5">

<p>how should we share org-babel?
</p>
</div>

<div id="outline-container-1.5.1" class="outline-4">
<h4 id="sec-1.5.1"><span class="done DONE"> DONE</span> post to org-mode </h4>
<div class="outline-text-4" id="text-1.5.1">

</div>

</div>

<div id="outline-container-1.5.2" class="outline-4">
<h4 id="sec-1.5.2"><span class="todo TODO"> TODO</span> post to ess mailing list </h4>
<div class="outline-text-4" id="text-1.5.2">

<p>I'd like to not rush in to this, get some feedback from the org
list first and let my R usage of org-babel settle down. [DD]
</p></div>

</div>

<div id="outline-container-1.5.3" class="outline-4">
<h4 id="sec-1.5.3"><span class="done DONE"> DONE</span> create a org-babel page on worg </h4>
<div class="outline-text-4" id="text-1.5.3">

<ul>
<li id="sec-1.5.3.1"><span class="done DONE"> DONE</span> Getting hold of it instructions <br/>
<ul>
<li>
What about non-git users?
</li>
<li>
Are we moving/copying to contrib/?
</li>
</ul>
</li>
<li id="sec-1.5.3.2"><span class="done DEFERRED"> DEFERRED</span> Fixed width HTML output created by <code>...</code> is ugly! <br/>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.5.4" class="outline-4">
<h4 id="sec-1.5.4"><span class="todo TODO"> TODO</span> create a short screencast demonstrating org-babel in action </h4>
<div class="outline-text-4" id="text-1.5.4">

</div>

</div>

<div id="outline-container-1.5.5" class="outline-4">
<h4 id="sec-1.5.5"><span class="todo PROPOSED"> PROPOSED</span> a peer-reviewed publication? </h4>
<div class="outline-text-4" id="text-1.5.5">

<p>(see <a href="org-babel-paper/paper.html">paper.org</a>)
</p></div>

</div>

<div id="outline-container-1.5.6" class="outline-4">
<h4 id="sec-1.5.6">examples </h4>
<div class="outline-text-4" id="text-1.5.6">

<p>we need to think up some good examples
</p>
<ul>
<li id="sec-1.5.6.1">interactive tutorials <br/>
This could be a place to use <a href="#sec-1.55.1">org-babel assertions</a>.

<p>
for example the first step of a tutorial could assert that the version
of the software-package (or whatever) is equal to some value, then
source-code blocks could be used with confidence (and executed
directly from) the rest of the tutorial.
</p>
</li>
<li id="sec-1.5.6.2">answering a text-book question w/code example <br/>
org-babel is an ideal environment enabling both the development and
demonstrationg of the code snippets required as answers to many
text-book questions.

</li>
<li id="sec-1.5.6.3">something using tables <br/>
maybe something along the lines of calculations from collected grades

</li>
<li id="sec-1.5.6.4">file sizes <br/>
Maybe something like the following which outputs sizes of directories
under the home directory, and then instead of the trivial <code>emacs-lisp</code>
block we could use an R block to create a nice pie chart of the
results.




<pre class="src src-bash">du -sc ~/*
</pre>




<pre class="src src-emacs-lisp"><span class="org-esk-paren">(</span>mapcar #'car sizes<span class="org-esk-paren">)</span>
</pre>



</li>
</ul>
</div>

</div>

<div id="outline-container-1.5.7" class="outline-4">
<h4 id="sec-1.5.7"><span class="done DONE"> DONE</span> Answer to question on list </h4>
<div class="outline-text-4" id="text-1.5.7">

<p>From: Hector Villafuerte &lt;hectorvd@gmail.com&gt;
Subject: [Orgmode] Merge tables
Date: Wed, 19 Aug 2009 10:08:40 -0600
To: emacs-orgmode@gnu.org
</p>
<p>
Hi,
I've just discovered Org and are truly impressed with it; using it for
more and more tasks.
</p>
<p>
Here's what I want to do: I have 2 tables with the same number of rows
(one row per subject). I would like to make just one big table by
copying the second table to the right of the first one. This is a
no-brainer in a spreadsheet but my attempts in Org have failed. Any
ideas?
</p>
<p>
By the way, thanks for this great piece of software!
&ndash; 
hector
</p>
<ul>
<li id="sec-1.5.7.1">Suppose the tables are as follows <br/>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">a</th><th scope="col">b</th><th scope="col">c</th></tr>
</thead>
<tbody>
<tr><td>1</td><td>2</td><td>3</td></tr>
<tr><td>7</td><td>8</td><td>9</td></tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">d</th><th scope="col">e</th><th scope="col">f</th></tr>
</thead>
<tbody>
<tr><td>4</td><td>5</td><td>6</td></tr>
<tr><td>10</td><td>11</td><td>12</td></tr>
</tbody>
</table>


</li>
<li id="sec-1.5.7.2">Here is an answer using R in org-babel <br/>




<div class="org-src-container"><label class="org-src-name">column-bind(a=tab1, b=tab2)</label><pre class="src src-R">
cbind(a, b)
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" /><col align="left" /><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">"a"</th><th scope="col">"b"</th><th scope="col">"c"</th><th scope="col">"d"</th><th scope="col">"e"</th><th scope="col">"f"</th></tr>
</thead>
<tbody>
<tr><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td></tr>
<tr><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td></tr>
</tbody>
</table>



</li>
<li id="sec-1.5.7.3">Alternatively <br/>
Use org-table-export, do it in external spreadsheet software,
then org-table-import
</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-1.6" class="outline-3">
<h3 id="sec-1.6"><span class="todo PROPOSED"> PROPOSED</span> allow for stripping of header rows from table data </h3>
<div class="outline-text-3" id="text-1.6">

<p>maybe controlled by an argument
</p></div>

</div>

<div id="outline-container-1.7" class="outline-3">
<h3 id="sec-1.7"><span class="todo PROPOSED"> PROPOSED</span> Control precision of numerical output </h3>
<div class="outline-text-3" id="text-1.7">

<p>Does org have an option controlling precision of numbers in tables?
</p></div>

</div>

<div id="outline-container-1.8" class="outline-3">
<h3 id="sec-1.8"><span class="todo PROPOSED"> PROPOSED</span> allow `anonymous' function block with function call args? </h3>
<div class="outline-text-3" id="text-1.8">

<p>My question here is simply whether we're going to allow
</p>


<pre class="src src-python(arg=ref)"># whatever
</pre>



<p>
but with preference given to
</p></div>

</div>

<div id="outline-container-1.9" class="outline-3">
<h3 id="sec-1.9"><span class="todo PROPOSED"> PROPOSED</span> allow :result as synonym for :results? </h3>
<div class="outline-text-3" id="text-1.9">

</div>

</div>

<div id="outline-container-1.10" class="outline-3">
<h3 id="sec-1.10"><span class="todo PROPOSED"> PROPOSED</span> Creating presentations </h3>
<div class="outline-text-3" id="text-1.10">

<p>The <a href="#mairix:t:@@9854.1246500519@gamaville.dokosmarshall.org">recent thread</a> containing posts by Nick Dokos and Sebastian
Vaub√°n on exporting to beamer looked very interesting, but I
haven't had time to try it out yet. I would really like it if,
eventually, we can generate a presentation (with graphics generated
by code blocks) from the same org file that contains all the notes
and code etc. I just wanted that to be on record in this document;
I don't have anything more profound to say about it at the moment,
and I'm not sure to what extent it is an org-babel issue.
</p></div>

</div>

<div id="outline-container-1.11" class="outline-3">
<h3 id="sec-1.11"><span class="todo PROPOSED"> PROPOSED</span> conversion between org-babel and noweb (e.g. .Rnw) format </h3>
<div class="outline-text-3" id="text-1.11">

<p>I haven't thought about this properly. Just noting it down. What
Sweave uses is called "R noweb" (.Rnw).
</p>
<p>
I found a good description of noweb in the following article (see
the <a href="http://www.cs.tufts.edu/~nr/pubs/lpsimp.pdf">pdf</a>).
</p>
<p>
I think there are two parts to noweb, the construction of
documentation and the extraction of source-code (with notangle).
</p>
<p>
<b>documentation</b>: org-mode handles all of our documentation needs in
a manner that I believe is superior to noweb.
</p>
<p>
<b>source extraction</b> At this point I don't see anyone writing large
applications with 100% of the source code contained in org-babel
files, rather I see org-babel files containing things like
</p><ul>
<li>
notes with active code chunks
</li>
<li>
interactive tutorials
</li>
<li>
requirements documents with code running test suites
</li>
<li>
and of course experimental reports with the code to run the
experiment, and perform analysis

</li>
</ul>

<p>Basically I think the scope of the programs written in org-babel
(at least initially) will be small enough that it wont require the
addition of a tangle type program to extract all of the source code
into a running application.
</p>
<p>
On the other hand, since we already have named blocks of source
code which reference other blocks on which they rely, this
shouldn't be too hard to implement either on our own, or possibly
relying on something like noweb/notangle.
</p></div>

</div>

<div id="outline-container-1.12" class="outline-3">
<h3 id="sec-1.12"><span class="todo PROPOSED"> PROPOSED</span> Modify results value implementation </h3>
<div class="outline-text-3" id="text-1.12">

<ul>
<li>
State "PROPOSED"   from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-03 Wed 14:27</span></span>

</li>
</ul>

<p>Are results transferred to elisp via file?
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">language</th><th scope="col">session</th><th scope="col">shell process</th></tr>
</thead>
<tbody>
<tr><td>R</td><td>yes</td><td>yes</td></tr>
<tr><td>ruby</td><td>no</td><td>yes</td></tr>
<tr><td>python</td><td>no</td><td>yes</td></tr>
<tr><td>shell</td><td>no</td><td>no</td></tr>
<tr><td>haskell</td><td>no</td><td>NA</td></tr>
</tbody>
</table>


<p>
The main point is that in ruby and python, the printed values from the
interpreter can be used as results, whereas that's not really
attractive for R. However, one minor point is: ought we to consider
(in the interests of consistency) not using files for ruby
shell-process and python shell-process?
</p>
</div>

</div>

<div id="outline-container-1.13" class="outline-3">
<h3 id="sec-1.13"><span class="done DONE"> DONE</span> allow 'output mode to return stdout as value? </h3>
<div class="outline-text-3" id="text-1.13">

<p>We do allow this now. It turned out to be necessary for lob calls using output mode.
</p>
<p>
Maybe we should allow this. In fact, if block x is called
with :results output, and it references blocks y and z, then
shouldn't the output of x contain a concatenation of the outputs of
y and z, together with x's own output? That would raise the
question of what happens if y is defined with :results output and z
with :results value. I guess z's (possibly vector/tabular) output
would be inside a literal example block containing the whole lot.
</p></div>

</div>

<div id="outline-container-1.14" class="outline-3">
<h3 id="sec-1.14"><span class="done DONE"> DONE</span> Reworking output: verbatim, pretty-print, vector/scalar etc </h3>
<div class="outline-text-3" id="text-1.14">

<p>See emails on subject between ES, BA, DED.
</p>
</div>

<div id="outline-container-1.14.1" class="outline-4">
<h4 id="sec-1.14.1">Draft of conclusions of email discussion </h4>
<div class="outline-text-4" id="text-1.14.1">

<ul>
<li>
We add two new :results options (which only take effect
with :results value):
<ul>
<li>
<b>[X]</b> parseable (code) output
</li>
<li>
<b>[X]</b> pretty-printed output
</li>
</ul>
</li>
<li>
We get rid of :results scalar: [EMS] I don't see why results
scalar is on the chopping block?  Did we want another name for
this value, or is it overcome by the verbatim/code options?  For
now I propose we leave the scalar option unchanged.
</li>
<li>
<b>[X]</b> We rename :results vector -&gt; table (even though this will be
the default it is nice to have a name for it, and we need a
symbolic name for implementing &ndash; and allowing users to
change &ndash; the default behavior)
</li>
<li>
<b>[X]</b> We force :results output to be empty for elisp
</li>
</ul>
</div>

</div>

<div id="outline-container-1.14.2" class="outline-4">
<h4 id="sec-1.14.2">Parseable output </h4>
<div class="outline-text-4" id="text-1.14.2">

<ul>
<li>
output as code block
</li>
<li>
possible :results option names
<ul>
<li>
parseable
</li>
<li>
verbatim
</li>
<li>
code
</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.14.3" class="outline-4">
<h4 id="sec-1.14.3">Pretty-printed output </h4>
<div class="outline-text-4" id="text-1.14.3">

<ul>
<li>
output as literal text block (not as code block)
</li>
<li>
possible :results option names
<ul>
<li>
pretty
</li>
<li>
pretty-print
</li>
<li>
pp

</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.14.4" class="outline-4">
<h4 id="sec-1.14.4">Language-specific implementation </h4>
<div class="outline-text-4" id="text-1.14.4">


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">language</th><th scope="col">parseable</th><th scope="col">pretty</th><th scope="col">Notes</th></tr>
</thead>
<tbody>
<tr><td>emacs-lisp</td><td>pp</td><td>pp</td><td></td></tr>
<tr><td>ruby</td><td>?pp</td><td>pp</td><td>is pp output parseable?</td></tr>
<tr><td>python</td><td>pprint.pprint</td><td>pprint.pprint</td><td></td></tr>
<tr><td>perl</td><td>?</td><td>?</td><td></td></tr>
<tr><td>R</td><td>dput</td><td>default interpreter output?</td><td></td></tr>
<tr><td>shell</td><td>NA</td><td>NA</td><td>no such thing as :results value</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.14.5" class="outline-4">
<h4 id="sec-1.14.5"><span class="done DONE"> DONE</span> pretty print source results </h4>
<div class="outline-text-4" id="text-1.14.5">


<p>
[ see above ]
</p>
<p>
add a result type for the display of source-code objects.  results of
this type should be wrapped in source-code blocks.
</p>
<p>
inspired by Benny's pp patch for emacs-lisp (below)
</p>



<pre class="example">  diff --git a/contrib/babel/lisp/langs/org-babel-emacs-lisp.el b/contrib/babel/lisp/langs/org-babel-emacs-lisp.el
index 39f5cc7..60671ac 100644
--- a/contrib/babel/lisp/langs/org-babel-emacs-lisp.el
+++ b/contrib/babel/lisp/langs/org-babel-emacs-lisp.el
@@ -39,10 +39,14 @@
   "Execute a block of emacs-lisp code with org-babel.  This
 function is called by `org-babel-execute-src-block' via multiple-value-bind."
   (message "executing emacs-lisp code block...")
-  (save-window-excursion
-    (let ((print-level nil) (print-length nil))
-      (eval `(let ,(mapcar (lambda (var) `(,(car var) ',(cdr var))) vars)
-              ,(read (concat "(progn " body ")")))))))
+  (let ((results (cdr (assoc :results params))))
+    (save-window-excursion
+      (let ((print-level nil) (print-length nil))
+        (eval `(let ,(mapcar (lambda (var) `(,(car var) ',(cdr var))) vars)
+                 ,(read (concat "(progn " (if (string-match "pp$" results)
+                                              (concat "(pp " body ")")
+                                              body)
+                                ")"))))))))
 
 (provide 'org-babel-emacs-lisp)
 ;;; org-babel-emacs-lisp.el ends here
</pre>



<p>
something similar for ruby exists here
<a href="http://www.ruby-doc.org/stdlib/libdoc/pp/rdoc/index.html">http://www.ruby-doc.org/stdlib/libdoc/pp/rdoc/index.html</a>
</p></div>

</div>

<div id="outline-container-1.14.6" class="outline-4">
<h4 id="sec-1.14.6"><span class="done DONE"> DONE</span> Finalise behaviour regarding vector/scalar output </h4>
<div class="outline-text-4" id="text-1.14.6">

<p>[ see above ]
</p></div>

</div>

<div id="outline-container-1.14.7" class="outline-4">
<h4 id="sec-1.14.7"><span class="done DONE"> DONE</span> Stop spaces causing vector output </h4>
<div class="outline-text-4" id="text-1.14.7">

<p>This simple example of multilingual chaining produces vector output if
there are spaces in the message and scalar otherwise.
</p>
<p>
[Not any more]
</p>



<div class="org-src-container"><label class="org-src-name">msg-from-R(msg=msg-from-python)</label><pre class="src src-R">
paste(msg, <span class="org-string">"und R"</span>, sep=<span class="org-string">" "</span>)
</pre></div>




<pre class="example">
org-babel speaks elisp y python und R
</pre>





<div class="org-src-container"><label class="org-src-name">msg-from-python(msg=msg-from-elisp)</label><pre class="src src-python">
msg + <span class="org-string">" y python"</span>
</pre></div>





<div class="org-src-container"><label class="org-src-name">msg-from-elisp(msg="org-babel speaks")</label><pre class="src src-emacs-lisp">
<span class="org-esk-paren">(</span>concat msg <span class="org-string">" elisp"</span><span class="org-esk-paren">)</span>
</pre></div>




</div>
</div>

</div>

<div id="outline-container-1.15" class="outline-3">
<h3 id="sec-1.15"><span class="done DONE"> DONE</span> support for passing paths to files between source blocks </h3>
<div class="outline-text-3" id="text-1.15">

<p>Maybe this should be it's own result type (in addition to scalars and
vectors).  The reason being that some source-code blocks (for example
ditaa or anything that results in the creation of a file) may want to
pass a file path back to org-mode which could then be inserted into
the org-mode buffer as a link to the file&hellip;
</p>
<p>
This would allow for display of images upon export providing
functionality similar to <code>org-exp-blocks</code> only in a more general
manner.
</p></div>

</div>

<div id="outline-container-1.16" class="outline-3">
<h3 id="sec-1.16"><span class="done DEFERRED"> DEFERRED</span> optional timestamp for output </h3>
<div class="outline-text-3" id="text-1.16">

<p><b>DEFERRED</b>: I'm deferring this in deference to the better caching
system proposed by Carsten. (see <a href="#sec-1.16">sha1-caching</a>)
</p>
<p>
Add option to place an (inactive) timestamp at the #+resname, to
record when that output was generated.
</p>

</div>

<div id="outline-container-1.16.1" class="outline-4">
<h4 id="sec-1.16.1">source code block timestamps (optional addition) </h4>
<div class="outline-text-4" id="text-1.16.1">

<p>[Eric] If we did this would we then want to place a timestamp on the
source-code block, so that we would know if the results are
current or out of date?  This would have the effect of caching the
results of calculations and then only re-running if the
source-code has changed.  For the caching to work we would need to
check not only the timestamp on a source-code block, but also the
timestamps of any tables or source-code blocks referenced by the
original source-code block.
</p>
<p>
[Dan] I do remember getting frustrated by Sweave always having to
re-do everything, so this could be desirable, as long as it's easy
to over-ride of course. I'm not sure it should be the default
behaviour unless we are very confident that it works well.
</p>
<ul>
<li id="sec-1.16.1.1">maintaining source-code block timestamps <br/>
It may make sense to add a hook to `org-edit-special' which could
update the source-code blocks timestamp.  If the user edits the
contents of a source-code block directly I can think of no
efficient way of maintaining the timestamp.
</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-1.17" class="outline-3">
<h3 id="sec-1.17"><span class="done DEFERRED"> DEFERRED</span> source-name visible in LaTeX and html exports </h3>
<div class="outline-text-3" id="text-1.17">

<p>Maybe this should be done in backend specific manners.
</p>
<p>
The listings package may provide for naming a source-code block&hellip;
</p>
<p>
Actually there is no obvious simple and attractive way to implement
this.  Closing this issue for now.
</p></div>

</div>

<div id="outline-container-1.18" class="outline-3">
<h3 id="sec-1.18"><span class="done DEFERRED"> DEFERRED</span> Support rownames and other org babel table features? </h3>
<div class="outline-text-3" id="text-1.18">


<p>
The full org table features are detailed in the manual <a href="http://orgmode.org/manual/Advanced-features.html#Advanced-features">here</a>.
</p>

</div>

<div id="outline-container-1.18.1" class="outline-4">
<h4 id="sec-1.18.1">rownames </h4>
<div class="outline-text-4" id="text-1.18.1">

<p>Perhaps add a :rownames header arg. This would be an integer
(usually 1) which would have the effect of post-processing all the
variables created in the R session in the following way: if the
integer is j, set the row names to the contents of column j and
delete column j. Perhaps it is artificial to allow this integer to
take any value other than 1. The default would be nil which would
mean no such behaviour.
</p>
<p>
Actually I don't know about that. If multiple variables are passed
in, it's not appropriate to alter them all in the same way. The
rownames specification would normally refer to just one of the
variables. For now maybe just say this has to be done in R. E.g.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="right" /><col align="left" /><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">collection</th><th scope="col">size</th><th scope="col">exclude</th><th scope="col">include</th><th scope="col">exclude2</th><th scope="col">include2</th></tr>
</thead>
<tbody>
<tr><td>58C</td><td>2936</td><td>8</td><td>2928</td><td>256</td><td>2680</td></tr>
<tr><td>MS</td><td>5852</td><td>771</td><td>5081</td><td>771</td><td>5081</td></tr>
<tr><td>NBS</td><td>2929</td><td>64</td><td>2865</td><td>402</td><td>2527</td></tr>
<tr><td>POBI</td><td>2717</td><td>1</td><td>2716</td><td>1</td><td>2716</td></tr>
<tr><td>58C+MS+NBS+POBI</td><td></td><td></td><td>13590</td><td></td><td>13004</td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">make-size-table(size=sample-sizes)</label><pre class="src src-R">
rownames(size) <span class="org-constant">&lt;-</span> size[,1]
size <span class="org-constant">&lt;-</span> size[,-1]
</pre></div>





</div>

</div>

<div id="outline-container-1.18.2" class="outline-4">
<h4 id="sec-1.18.2">Old notes </h4>
<div class="outline-text-4" id="text-1.18.2">

<p>[I don't think it's as problematic as this makes out]
This is non-trivial, but may be worth doing, in particular to
develop a nice framework for sending data to/from R.
</p><ul>
<li id="sec-1.18.2.1">Notes <br/>
In R, indexing vector elements, and rows and columns, using
strings rather than integers is an important part of the
language.
<ul>
<li>
elements of a vector may have names
</li>
<li>
matrices and data.frames may have "column names" and "row names"
which can be used for indexing
</li>
<li>
In a data frame, row names <b>must</b> be unique
</li>
</ul>

<p>Examples
</p>


<pre class="example">&gt; # a named vector
&gt; vec &lt;- c(a=1, b=2)
&gt; vec["b"]
b 
2 
&gt; mat &lt;- matrix(1:4, nrow=2, ncol=2, dimnames=list(c("r1","r2"), c("c1","c2")))
&gt; mat
   c1 c2
r1  1  3
r2  2  4
&gt; # The names are separate from the data: they do not interfere with operations on the data
&gt; mat * 3
   c1 c2
r1  3  9
r2  6 12
&gt; mat["r1","c2"]



<p>
So it's tempting to try to provide support for this in org-babel. For example
</p><ul>
<li>
allow R to refer to columns of a :var reference by their names
</li>
<li>
When appropriate, results from R appear in the org buffer with "named
columns (and rows)"

<p>
However none (?) of the other languages we are currently supporting
really have a native matrix type, let alone "column names" or "row
names". Names are used in e.g. python and perl to refer to entries
in dicts / hashes.
</p>
<p>
It currently seems to me that support for this in org-babel would
require setting rules about when org tables are considered to have
named columns/fields, and ensuring that (a) languages with a notion
of named columns/fields use them appropriately and (b) languages
with no such notion do not treat then as data.
</p>
</li>
<li>
Org allows something that <b>looks</b> like column names to be separated
by a hline
</li>
<li>
Org also allows a row to <b>function</b> as column names when special
markers are placed in the first column. An hline is unnecessary
(indeed hlines are purely cosmetic in org [correct?]
</li>
<li>
Org does not have a notion of "row names" [correct?]

<p>
The full org table functionality exeplified <a href="http://orgmode.org/manual/Advanced-features.html#Advanced-features">here</a> has features that
we would not support in e.g. R (like names for the row below).
</p>
</li>
</ul>
</li>
<li id="sec-1.18.2.2">Initial statement: allow tables with hline to be passed as args into R <br/>
This doesn't seem to work at the moment (example below). It would
also be nice to have a natural way for the column names of the org
table to become the column names of the R data frame, and to have
the option to specify that the first column is to be used as row
names in R (these must be unique). But this might require a bit of
thinking about.


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">col1</th><th scope="col">col2</th><th scope="col">col3</th></tr>
</thead>
<tbody>
<tr><td>1</td><td>2</td><td>3</td></tr>
<tr><td>4</td><td>schulte</td><td>6</td></tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td><td>3</td></tr>
<tr><td>4</td><td>schulte</td><td>6</td></tr>
</tbody>
</table>





<pre class="src src-R">tabel
</pre>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">"col1"</th><th scope="col">"col2"</th><th scope="col">"col3"</th></tr>
</thead>
<tbody>
<tr><td>1</td><td>2</td><td>3</td></tr>
<tr><td>4</td><td>"schulte"</td><td>6</td></tr>
</tbody>
</table>



<p>
Another example is in the <a href="#*operations==in==on==tables">grades example</a>.
</p></li>
</ul>
</div>
</div>

</div>

<div id="outline-container-1.19" class="outline-3">
<h3 id="sec-1.19"><span class="done DEFERRED"> DEFERRED</span> use textConnection to pass tsv to R? </h3>
<div class="outline-text-3" id="text-1.19">

<p>When passing args from the org buffer to R, the following route is
used: arg in buffer -&gt; elisp -&gt; tsv on file -&gt; data frame in R. I
think it would be possible to avoid having to write to file by
constructing an R expression in org-babel-R-assign-elisp, something
like this
</p>



<pre class="src src-emacs-lisp"><span class="org-esk-paren">(</span>org-babel-R-input-command
 <span class="org-esk-paren">(</span>format  <span class="org-string">"%s &lt;- read.table(textConnection(\"%s\"), sep=\"\\t\", as.is=TRUE)"</span>
          name <span class="org-esk-paren">(</span>orgtbl-to-tsv value '<span class="org-esk-paren">(</span><span class="org-builtin">:sep</span> <span class="org-string">"\t"</span> <span class="org-builtin">:fmt</span> org-babel-R-quote-tsv-field<span class="org-esk-paren">))))</span>
</pre>




<p>
I haven't tried to implement this yet as it's basically just
fiddling with something that works. The only reason for it I can
think of would be efficiency and I haven't tested that.
</p>
<p>
This Didn't work after an initial test.  I still think this is a
good idea (I also think we should try to do something similar when
writing out results frmo R to elisp) however as it wouldn't result
in any functional changes I'm bumping it down to deferred for
now. [Eric]
</p>
<p>
for quick tests
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td><td>3</td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">quick-test-src-blk(vec=quick-test)</label><pre class="src src-R">
mean(mean(vec))
</pre></div>




<pre class="example">
2
</pre>



<pre class="example">
2
</pre>


</div>

</div>

<div id="outline-container-rework-running-proc-interaction" class="outline-3">
<h3 id="rework-running-proc-interaction"><a name="sec-1.20" id="sec-1.20"></a><span class="done DEFERRED"> DEFERRED</span> Rework Interaction with Running Processes [2/5] </h3>
<div class="outline-text-3" id="text-rework-running-proc-interaction">



</div>

<div id="outline-container-1.20.1" class="outline-4">
<h4 id="sec-1.20.1"><span class="done DONE"> DONE</span> robust to errors interrupting execution </h4>
<div class="outline-text-4" id="text-1.20.1">





<div class="org-src-container"><label class="org-src-name">long-runner-ruby()</label><pre class="src src-ruby">
sleep(10)
<span class="org-constant">:patton_is_an_grumpy</span>
</pre></div>




</div>

</div>

<div id="outline-container-1.20.2" class="outline-4">
<h4 id="sec-1.20.2"><span class="done DEFERRED"> DEFERRED</span> use <code>C-g</code> keyboard-quit to push processing into the background </h4>
<div class="outline-text-4" id="text-1.20.2">

<p>This may be possible using the `run-with-timer' command.
</p>
<p>
I have no idea how this could work&hellip;
</p>



<div class="org-src-container"><label class="org-src-name">long-runner-ruby()</label><pre class="src src-ruby">
sleep(10)
<span class="org-constant">:patton_is_an_grumpy</span>
</pre></div>




</div>

</div>

<div id="outline-container-1.20.3" class="outline-4">
<h4 id="sec-1.20.3"><span class="todo TODO"> TODO</span> ability to select which of multiple sessions is being used </h4>
<div class="outline-text-4" id="text-1.20.3">

<p>Increasingly it is looking like we're going to want to run all
source code blocks in comint buffer (sessions).  Which will have
the benefits of
</p><ol>
<li>
allowing background execution
</li>
<li>
maintaining state between source-blocks
<ul>
<li>
allowing inline blocks w/o header arguments 

</li>
</ul>
</li>
</ol>
<ul>
<li id="sec-1.20.3.1">R sessions <br/>
(like ess-switch-process in .R buffers)

<p>
Maybe this could be packaged into a header argument, something
like <code>:R_session</code> which could accept either the name of the
session to use, or the string <code>prompt</code>, in which case we could use
the <code>ess-switch-process</code> command to select a new process.
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.20.4" class="outline-4">
<h4 id="sec-1.20.4"><span class="todo TODO"> TODO</span> evaluation of shell code as background process? </h4>
<div class="outline-text-4" id="text-1.20.4">

<p>After C-c C-c on an R code block, the process may appear to
block, but C-g can be used to reclaim control of the .org buffer,
without interrupting the R evalution. However I believe this is not
true of bash/sh evaluation. [Haven't tried other languages] Perhaps
a solution is just to background the individual shell commands.
</p>
<p>
The other languages (aside from emacs lisp) are run through the
shell, so if we find a shell solution it should work for them as
well.
</p>
<p>
Adding an ampersand seems to be a supported way to run commands in
the background (see <a href="http://www.emacswiki.org/emacs/ExecuteExternalCommand#toc4">external-commands</a>).  Although a more extensible
solution may involve the use of the <i>&lt;elisp:(progn (describe-function 'call-process-region) nil)&gt;</i> function.
</p>
<p>
Going to try this out in a new file <a href="lisp/org-babel-proc.el">org-babel-proc.el</a>.  This should
contain functions for asynchronously running generic shell commands
in the background, and then returning their input.
</p>
<ul>
<li id="sec-1.20.4.1">partial update of org-mode buffer <br/>
The sleekest solution to this may be using a comint buffer, and
then defining a filter function which would incrementally interpret
the results as they are returned, including insertion into the
org-mode buffer.  This may actually cause more problems than it is
worth, what with the complexities of identifying the types of
incrementally returned results, and the need for maintenance of a
process marker in the org buffer.

</li>
<li id="sec-1.20.4.2">'working' spinner <br/>
It may be nice and not too difficult to place a spinner on/near the
evaluating source code block

</li>
</ul>
</div>

</div>

<div id="outline-container-1.20.5" class="outline-4">
<h4 id="sec-1.20.5"><span class="todo TODO"> TODO</span> conversion of output from interactive shell, R (and python) sessions to org-babel buffers </h4>
<div class="outline-text-4" id="text-1.20.5">

<p>[DED] This would be a nice feature I think. Although an org-babel
purist would say that it's working the wrong way round&hellip; After
some interactive work in a <b>R</b> buffer, you save the buffer, maybe
edit out some lines, and then convert it to org-babel format for
posterity. Same for a shell session either in a <b>shell</b> buffer, or
pasted from another terminal emulator. And python of course.
</p></div>
</div>

</div>

<div id="outline-container-1.21" class="outline-3">
<h3 id="sec-1.21"><span class="done DEFERRED"> DEFERRED</span> improve the source-block snippet </h3>
<div class="outline-text-3" id="text-1.21">

<p>any real improvement seems somewhat beyond the ability of yasnippet
for now.
</p>
<p>
<a href="/home/eschulte/src/emacs-starter-kit/src/snippets/text-mode/rst-mode/chap">file:~/src/emacs-starter-kit/src/snippets/text-mode/rst-mode/chap::name Chapter title</a>
</p>


<pre class="example">#name : Chapter title
# --
${1:Chapter}
${1:$(make-string (string-width text) ?\=)}

$0
</pre>



<p>
<a href="snippets/org-mode/sb">sb &ndash; snippet</a>
</p>
<p>
waiting for guidance from those more familiar with yasnippets
</p>
</div>

</div>

<div id="outline-container-1.22" class="outline-3">
<h3 id="sec-1.22"><span class="done REJECTED"> REJECTED</span> re-implement R evaluation using ess-command or ess-execute </h3>
<div class="outline-text-3" id="text-1.22">

<p>I don't have any complaints with the current R evaluation code or
behaviour, but I think it would be good to use the ESS functions
from a political point of view. Plus of course it has the normal
benefits of an API (insulates us from any underlying changes etc). [DED]
</p>
<p>
I'll look into this.  I believe that I looked at and rejected these
functions initially but now I can't remember why.  I agree with
your overall point about using API's where available.  I will take
a look back at these and either switch to using the ess commands,
or at least articulate under this TODO the reasons for using our
custom R-interaction commands. [Eric]
</p>
<p>
ess-execute
</p>
<p>
Lets just replace <code>org-babel-R-input-command</code> with <code>ess-execute</code>.
</p>
<p>
I tried this, and although it works in some situations, I find that
<code>ess-command</code> will often just hang indefinitely without returning
results.  Also <code>ess-execute</code> will occasionally hang, and pops up
the buffer containing the results of the command's execution, which
is undesirable.  For now these functions can not be used.  Maybe
someone more familiar with the ESS code can recommend proper usage
of <code>ess-command</code> or some other lower-level function which could be
used in place of <a href="lisp/org-babel-R.el">org-babel-R-input-command</a>.
</p>

</div>

<div id="outline-container-1.22.1" class="outline-4">
<h4 id="sec-1.22.1">ess functions </h4>
<div class="outline-text-4" id="text-1.22.1">


<blockquote>

<p>(ess-command COM &amp;optional BUF SLEEP NO-PROMPT-CHECK)
</p>
<p>
Send the ESS process command COM and delete the output
from the ESS process buffer.  If an optional second argument BUF exists
save the output in that buffer. BUF is erased before use.
COM should have a terminating newline.
Guarantees that the value of .Last.value will be preserved.
When optional third arg SLEEP is non-nil, `(sleep-for (* a SLEEP))'
will be used in a few places where `a' is proportional to `ess-cmd-delay'.
</p>
</blockquote>


<blockquote>

<p>(ess-execute COMMAND &amp;optional INVERT BUFF MESSAGE)
</p>
<p>
Send a command to the ESS process.
A newline is automatically added to COMMAND.  Prefix arg (or second arg
INVERT) means invert the meaning of
`ess-execute-in-process-buffer'.  If INVERT is 'buffer, output is
forced to go to the process buffer.  If the output is going to a
buffer, name it <b>BUFF</b>.  This buffer is erased before use.  Optional
fourth arg MESSAGE is text to print at the top of the buffer (defaults
to the command if BUFF is not given.)
</p>
</blockquote>


</div>

</div>

<div id="outline-container-1.22.2" class="outline-4">
<h4 id="sec-1.22.2">out current setup </h4>
<div class="outline-text-4" id="text-1.22.2">


<ol>
<li>
The body of the R source code block is wrapped in a function
</li>
<li>
The function is called inside of a <code>write.table</code> function call
writing the results to a table
</li>
<li>
The table is read using <code>org-table-import</code>
</li>
</ol>
</div>
</div>

</div>

<div id="outline-container-1.23" class="outline-3">
<h3 id="sec-1.23"><span class="done DONE"> DONE</span> Incorporate <a href="http://github.com/bandresen/org-babel-screen">Benny Andresen's GNU screen interpreter</a> </h3>
<div class="outline-text-3" id="text-1.23">

</div>

</div>

<div id="outline-container-1.24" class="outline-3">
<h3 id="sec-1.24"><span class="done DONE"> DONE</span> Ensure that #+lob calls honour header args </h3>
<div class="outline-text-3" id="text-1.24">

<p>Currently, the header args defined in a source block are not
honoured when that source block is referenced by a #+lob call.
</p>
</div>

<div id="outline-container-1.24.1" class="outline-4">
<h4 id="sec-1.24.1">Solutions </h4>
<div class="outline-text-4" id="text-1.24.1">

<p>Maybe we will have to either stop using an emacs-lisp block in the
lob implementation, or provide some mechanism for the emacs-lisp
blocks to pass unused header arguments through to their :var
blocks.  At first glance the former seems much cleaner. [Eric]
</p><ul>
<li id="sec-1.24.1.1">Allow header args on lob line <br/>
commit da1f07620862a2f8701597fbd6d8ceca93183840
</li>
</ul>
</div>

</div>

<div id="outline-container-1.24.2" class="outline-4">
<h4 id="sec-1.24.2">Example </h4>
<div class="outline-text-4" id="text-1.24.2">

<p>Here's a source block that defines the action we want to do.
</p>

<p>
And here's some more text.
</p>
<ul>
<li id="sec-1.24.2.1">Another heading <br/>

</li>
<li id="sec-1.24.2.2">Finally <br/>
Here is where we actually want the image to appear




<label class="org-src-name">myplot()</label>


<p>
<img src="blue.png"  alt="blue.png" />
</p></li>
</ul>
</div>
</div>

</div>

<div id="outline-container-1.25" class="outline-3">
<h3 id="sec-1.25"><span class="done DONE"> DONE</span> dynamic clock tables (as input to source blocks) </h3>
<div class="outline-text-3" id="text-1.25">

<p>something like&hellip;
</p>
<pre class="example">
#+BEGIN: clocktable :maxlevel 2 :block today :scope tree1 :link t :name todays-clock
#+END: clocktable
</pre>


<p>
These actually work given the current setup, the tables simply need to
be named using a <code>#+TBLNAME:</code> line.
</p>
<pre class="example">
#+TBLNAME: todays-times
#+BEGIN: clocktable :maxlevel 2 :block today :scope tree1 :link t :name todays-clock
#+END: clocktable
</pre>

</div>

</div>

<div id="outline-container-1.26" class="outline-3">
<h3 id="sec-1.26"><span class="done DONE"> DONE</span> figure out how to handle graphic output </h3>
<div class="outline-text-3" id="text-1.26">


<p>
This is listed under <a href="#*==graphical==output">graphical output</a> in out objectives.
</p>
<p>
This should take advantage of the <code>:results file</code> option, and
languages which almost always produce graphical output should set
<code>:results file</code> to true by default (this is currently done for the
gnuplot and ditaa languages).  That would handle placing these results
in the buffer.  Then if there is a combination of <code>silent</code> and <code>file</code>
<code>:results</code> headers we could drop the results to a temp buffer and pop
open that buffer&hellip;
</p>
<p>
Display of file results is addressed in the <a href="#*===\C-c==\C-o===to==open==results==of==source==block">open-results-task</a>.
</p>
<p>
I think this is done for now.  With the ability of the file option it
is now possible to save images directly to a file.  Then calling
<code>\C-c\C-o</code> with point on the source block will open the related
results.
</p>

</div>

<div id="outline-container-1.26.1" class="outline-4">
<h4 id="sec-1.26.1">R graphics to screen means session evaluation </h4>
<div class="outline-text-4" id="text-1.26.1">

<p>If R graphical output is going to screen then evaluation must be
in a session, otherwise the graphics will disappear as soon as the
R process dies.
</p>
</div>

</div>

<div id="outline-container-1.26.2" class="outline-4">
<h4 id="sec-1.26.2">Adding to a discussion started in email </h4>
<div class="outline-text-4" id="text-1.26.2">

<p>I'm not deeply wedded to these ideas, just noting them down. I'm
probably just thinking of R and haven't really thought about how
this fits with the other graphics-generating languages.
Dan:
&gt; I used the approach below to get graphical file output
&gt; today, which is one idea at least. Maybe it could be linked up with
&gt; your :results file variable. (Or do we need a :results image for R?)
&gt;
Eric:
I don't think we need a special image results variable, but I may be
missing what the code below accomplishes.  Would the task I added about
adding org-open-at-point functionality to source code blocks take care
of this need?
</p>
<p>
Dan: I'm not sure. I think the ability for a script to generate both
text and graphical output might be a natural expectation, at least for
R users.
</p>
<p>
&gt;
&gt; Dan
&gt;
&gt; #+srcname: cohort-scatter-plots-2d(org<sub>babel</sub><sub>graphical</sub><sub>output</sub><sub>file</sub>="cohort-scatter-plots-2d.png")
&gt; #+begin<sub>src</sub> R 
&gt;   if(exists("org<sub>babel</sub><sub>output</sub><sub>file</sub>"))
&gt;       png(filename=org<sub>babel</sub><sub>graphical</sub><sub>output</sub><sub>file</sub>, width=1000, height=1000)
&gt;   ## plotting code in here
&gt;   if(exists("org<sub>babel</sub><sub>graphical</sub><sub>output</sub><sub>file</sub>")) dev.off()
&gt; #+end<sub>src</sub>
</p>
<p>
Dan: Yes, the results :file option is nice for dealing with graphical
output, and that could well be enough. Something based on the scheme
above would have a couple of points in its favour:
</p><ol>
<li>
It's easy to switch between output going to on-screen graphics and
output going to file: Output will go to screen unless a string variable
with a standard name (e.g. ""org<sub>babel</sub><sub>graphical</sub><sub>output</sub><sub>file</sub>"")
exists in which case it will go to the file indicated by the value
of that variable.
</li>
<li>
The block can return a result / script output, as well as produce
graphical output.

</li>
</ol>

<p>In interactive use we might want to allow the user to choose between
screen and file output. In non-interactive use such as export, it
would be file output (subject to the :exports directives).
</p></div>
</div>

</div>

<div id="outline-container-1.27" class="outline-3">
<h3 id="sec-1.27"><span class="done DONE"> DONE</span> new results types (org, html, latex) </h3>
<div class="outline-text-3" id="text-1.27">

<p>Thanks to Tom Short for this recommendation.
</p>
<dl>
<dt>raw or org</dt><dd>
in which case the results are implemented raw, unquoted
into the org-mode file.  This would also handle links as
source block output.
</dd>
<dt>html</dt><dd>
the results are inserted inside of a #+BEGIN<sub>HTML</sub> block
</dd>
<dt>latex</dt><dd>
the results are inserted inside of a #+BEGIN<sub>LATEX</sub> block

</dd>
</dl>

<p>It might look like:
</p><pre class="example">
#+begin_src R :session *R* :results org
cat("***** This is a table\n")
cat("| 1 | 2 | 3 |\n")
cat("[[http://google.com][Google it here]]\n"
#+end_src
       
#+resname:
***** This is a table
| 1 | 2 | 3 |
</pre>

<p><a href="http://google.com">: Google it here</a>
</p>
<p>
We actually might want to remove the <code>#+resname</code> line if the results
type is org-mode, not sure&hellip;  Either way I don't think there is a
good way to capture/remove org type results.
</p>

</div>

<div id="outline-container-1.27.1" class="outline-4">
<h4 id="sec-1.27.1">LaTeX </h4>
<div class="outline-text-4" id="text-1.27.1">




<div class="org-src-container"><label class="org-src-name">latex-results()</label><pre class="src src-emacs-lisp">
<span class="org-string">"this should be inside of a LaTeX block"</span>
</pre></div>





</div>

</div>

<div id="outline-container-1.27.2" class="outline-4">
<h4 id="sec-1.27.2">Html </h4>
<div class="outline-text-4" id="text-1.27.2">




<div class="org-src-container"><label class="org-src-name">html-results()</label><pre class="src src-emacs-lisp">
<span class="org-string">"this should be inside of a HTML block



and more



is long"</span>
</pre></div>






this should be inside of a HTML block



and more



is long

</div>

</div>

<div id="outline-container-1.27.3" class="outline-4">
<h4 id="sec-1.27.3">raw </h4>
<div class="outline-text-4" id="text-1.27.3">


<p>
Added a <code>raw</code> results header argument, which will insert the results
of a source-code block into an org buffer un-escaped.  Also, if the
results look like a table, then the table will be aligned.
</p>



<div class="org-src-container"><label class="org-src-name">raw-table-demonstration()</label><pre class="src src-ruby">
puts <span class="org-string">"| root | square |"</span>
puts <span class="org-string">"|---"</span>
10.times <span class="org-keyword">do</span> |n|
  puts <span class="org-string">"| </span><span class="org-variable-name">#{n}</span><span class="org-string"> | </span><span class="org-variable-name">#{n*n}</span><span class="org-string"> |"</span>
<span class="org-keyword">end</span>
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" />
</colgroup>
<thead>
<tr><th scope="col">root</th><th scope="col">square</th></tr>
</thead>
<tbody>
<tr><td>0</td><td>0</td></tr>
<tr><td>1</td><td>1</td></tr>
<tr><td>2</td><td>4</td></tr>
<tr><td>3</td><td>9</td></tr>
<tr><td>4</td><td>16</td></tr>
<tr><td>5</td><td>25</td></tr>
<tr><td>6</td><td>36</td></tr>
<tr><td>7</td><td>49</td></tr>
<tr><td>8</td><td>64</td></tr>
<tr><td>9</td><td>81</td></tr>
</tbody>
</table>


<p>
Not sure how/if this would work, but it may be desirable.
</p></div>
</div>

</div>

<div id="outline-container-1.28" class="outline-3">
<h3 id="sec-1.28"><span class="done DONE"> DONE</span> org-bable-tangle: no default extension if one already exists </h3>
<div class="outline-text-3" id="text-1.28">

</div>

</div>

<div id="outline-container-1.29" class="outline-3">
<h3 id="sec-1.29"><span class="done DONE"> DONE</span> take default values for header args from properties </h3>
<div class="outline-text-3" id="text-1.29">

<p>Use file-wide and subtree wide properties to set default values for
header args.
</p>
<p>
[DED] One thing I'm finding when working with R is that an org file
may contain many source blocks, but that I just want to evaluate a
subset of them. Typically this is in order to take up where I left
off: I need to recreate a bunch of variables in the session
environment. I'm thinking maybe we want to use a tag-based
mechanism similar to :export: and :noexport: to control evaluation
on a per-subtree basis.
</p>

</div>

<div id="outline-container-1.29.1" class="outline-4">
<h4 id="sec-1.29.1">test-header with properties </h4>
<div class="outline-text-4" id="text-1.29.1">


<p>
Ahh&hellip; as is so often the case, just had to wrap
`org-babel-params-from-properties' in a `save-match-data' form.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td><td>3</td><td>4</td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">default-props-implementation(def=8, my-lis=why-def-props-cause-probs)</label><pre class="src src-emacs-lisp">
<span class="org-esk-paren">(</span>+ <span class="org-esk-paren">(</span>length my-lis<span class="org-esk-paren">)</span> def<span class="org-esk-paren">)</span>
</pre></div>




</div>
</div>

</div>

<div id="outline-container-1.30" class="outline-3">
<h3 id="sec-1.30"><span class="done DONE"> DONE</span> new reference syntax <b>inside</b> source code blocks </h3>
<div class="outline-text-3" id="text-1.30">

<p>This is from an email discussion on the org-mode mailing list with
S√©bastien.  The goal here is to mimic the source-block reference style
of Noweb.  Upon export and/or tangle these references could be
replaced with the actual body of the referenced source-code block.
</p>
<p>
See the following for an example.
</p>



<div class="org-src-container"><label class="org-src-name">ems-ruby-print-header()</label><pre class="src src-ruby">
puts <span class="org-string">"---------------------------header---------------------------"</span>
</pre></div>





<div class="org-src-container"><label class="org-src-name">emacs-ruby-print-footer()</label><pre class="src src-ruby">
puts <span class="org-string">"---------------------------footer---------------------------"</span>
</pre></div>





<div class="org-src-container"><label class="org-src-name">ems-ruby-print-message()</label><pre class="src src-ruby">
<span class="org-comment-delimiter"># </span><span class="org-comment">&lt;&lt;ems-ruby-print-header&gt;&gt;
</span>puts <span class="org-string">"                            Ruby                            "</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&lt;&lt;ems-ruby-print-footer&gt;&gt;
</span></pre></div>




<p>
Upon export the previous source-code block would result in a file
being generated at <code>ruby-noweb.rb</code> with the following contents
</p>
<pre class="example">
puts "---------------------------header---------------------------"
puts "                            Ruby                            "
puts "---------------------------footer---------------------------"
</pre>


<p>
the body of a source-code block with all <code>&lt;&lt;src-name&gt;&gt;</code> references
expanded can now be returned by `org-babel-expand-noweb-references'.
This function is now called by default on all source-code blocks on
export.
</p>
</div>

</div>

<div id="outline-container-1.31" class="outline-3">
<h3 id="sec-1.31"><span class="done DONE"> DONE</span> re-work tangling system </h3>
<div class="outline-text-3" id="text-1.31">

<p>Sometimes when tangling a file (e.g. when extracting elisp from a
org-mode file) we want to get nearly every source-code block.
</p>
<p>
Sometimes we want to only extract those source-code blocks which
reference a indicate that they should be extracted (e.g. traditional
literate programming along the Noweb model)
</p>
<p>
I'm not sure how we can devise a single simple tangling system that
naturally fits both of these use cases.
</p>

</div>

<div id="outline-container-1.31.1" class="outline-4">
<h4 id="sec-1.31.1">new setup </h4>
<div class="outline-text-4" id="text-1.31.1">

<p>the <code>tangle</code> header argument will default to <code>no</code> meaning source-code
blocks will <b>not</b> be exported by default.  In order for a source-code
block to be tangled it needs to have an output file specified.  This
can happen in two ways&hellip;
</p>
<ol>
<li>
a file-wide default output file can be passed to `org-babel-tangle'
which will then be used for all blocks
</li>
<li>
if the value of the <code>tangle</code> header argument is anything other than
<code>no</code> or <code>yes</code> then it is used as the file name


</li>
</ol>


<div class="org-src-container"><label class="org-src-name">test-new-tangling()</label><pre class="src src-emacs-lisp">
<span class="org-esk-paren">(</span>org-babel-load-file <span class="org-string">"test-tangle.org"</span><span class="org-esk-paren">)</span>
<span class="org-esk-paren">(</span><span class="org-keyword">if</span> <span class="org-esk-paren">(</span>string= test-tangle-advert <span class="org-string">"use org-babel-tangle for all your emacs initialization files!!"</span><span class="org-esk-paren">)</span>
    <span class="org-string">"succeed"</span>
  <span class="org-string">"fail"</span><span class="org-esk-paren">)</span>
</pre></div>




<pre class="example">
succeed
</pre>


</div>
</div>

</div>

<div id="outline-container-1.32" class="outline-3">
<h3 id="sec-1.32"><span class="done DONE"> DONE</span> <code>\C-c \C-o</code> to open results of source block </h3>
<div class="outline-text-3" id="text-1.32">

<p>by adding a <code>defadvice</code> to <code>org-open-at-point</code> we can use the common
<code>\C-c \C-o</code> keybinding to open the results of a source-code block.
This would be especially useful for source-code blocks which generate
graphical results and insert a file link as the results in the
org-mode buffer.  (see <a href="#sec-1.26">TODO figure out how to handle graphic output</a>).
This could also act reasonably with other results types&hellip;
</p>
<dl>
<dt>file</dt><dd>
use org-open-at-point to open the file
</dd>
<dt>scalar</dt><dd>
open results unquoted in a new buffer
</dd>
<dt>tabular</dt><dd>
export the table to a new buffer and open that buffer

</dd>
</dl>

<p>when called with a prefix argument the block is re-run
</p>


<p>
<img src="blue.png"  alt="blue.png" />
<a href="blue.png"><img src="blue.png"/></a>
</p>



<div class="org-src-container"><label class="org-src-name">task-open-vector()</label><pre class="src src-emacs-lisp">
'<span class="org-esk-paren">((</span>1 2<span class="org-esk-paren">)</span> <span class="org-esk-paren">(</span>3 4<span class="org-esk-paren">))</span>
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td></tr>
<tr><td>3</td><td>4</td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">task-open-scalar()</label><pre class="src src-ruby">
8.times <span class="org-keyword">do</span> |n|
  puts <span class="org-string">"row </span><span class="org-variable-name">#{n}</span><span class="org-string">"</span>
<span class="org-keyword">end</span>
</pre></div>




<pre class="example">
row 0
row 1
row 2
row 3
row 4
row 5
row 6
row 7
</pre>


</div>

</div>

<div id="outline-container-1.33" class="outline-3">
<h3 id="sec-1.33"><span class="done DONE"> DONE</span> Stop spaces causing vector output </h3>
<div class="outline-text-3" id="text-1.33">

<p>This simple example of multilingual chaining produces vector output if
there are spaces in the message and scalar otherwise.
</p>
<p>
[Not any more]
</p>



<div class="org-src-container"><label class="org-src-name">msg-from-R(msg=msg-from-python)</label><pre class="src src-R">
paste(msg, <span class="org-string">"und R"</span>, sep=<span class="org-string">" "</span>)
</pre></div>




<pre class="example">
org-babel speaks elisp y python und R
</pre>





<div class="org-src-container"><label class="org-src-name">msg-from-python(msg=msg-from-elisp)</label><pre class="src src-python">
msg + <span class="org-string">" y python"</span>
</pre></div>





<div class="org-src-container"><label class="org-src-name">msg-from-elisp(msg="org-babel speaks")</label><pre class="src src-emacs-lisp">
<span class="org-esk-paren">(</span>concat msg <span class="org-string">" elisp"</span><span class="org-esk-paren">)</span>
</pre></div>




</div>

</div>

<div id="outline-container-1.34" class="outline-3">
<h3 id="sec-1.34"><span class="done DONE"> DONE</span> add <code>:tangle</code> family of header arguments </h3>
<div class="outline-text-3" id="text-1.34">

<p>values are
</p><dl>
<dt>no</dt><dd>
don't include source-code block when tangling
</dd>
<dt>yes</dt><dd>
do include source-code block when tangling

</dd>
</dl>

<p>this is tested in <a href="test-tangle.html">test-tangle.org</a>
</p>
</div>

</div>

<div id="outline-container-1.35" class="outline-3">
<h3 id="sec-1.35"><span class="done DONE"> DONE</span> extensible library of callable source blocks </h3>
<div class="outline-text-3" id="text-1.35">


</div>

<div id="outline-container-1.35.1" class="outline-4">
<h4 id="sec-1.35.1">Current design </h4>
<div class="outline-text-4" id="text-1.35.1">

<p>This is covered by the <a href="library-of-babel.html">Library of Babel</a>, which will contain
ready-made source blocks designed to carry out useful common tasks.
</p></div>

</div>

<div id="outline-container-1.35.2" class="outline-4">
<h4 id="sec-1.35.2">Initial statement [Eric] </h4>
<div class="outline-text-4" id="text-1.35.2">

<p>Much of the power of org-R seems to be in it's helper functions for
the quick graphing of tables.  Should we try to re-implement these
functions on top of org-babel?
</p>
<p>
I'm thinking this may be useful both to add features to org-babel-R and
also to potentially suggest extensions of the framework.  For example
one that comes to mind is the ability to treat a source-code block
like a function which accepts arguments and returns results. Actually
this can be it's own TODO (see <a href="#sec-1.58">source blocks as functions</a>).
</p></div>

</div>

<div id="outline-container-1.35.3" class="outline-4">
<h4 id="sec-1.35.3">Objectives [Dan] </h4>
<div class="outline-text-4" id="text-1.35.3">

<ul>
<li>
We want to provide convenient off-the-shelf actions
(e.g. plotting data) that make use of our new code evaluation
environment but do not require any actual coding.
</li>
</ul>
</div>

</div>

<div id="outline-container-1.35.4" class="outline-4">
<h4 id="sec-1.35.4">Initial Design proposal [Dan] </h4>
<div class="outline-text-4" id="text-1.35.4">

<ul>
<li>
<b>Input data</b> will be specified using the same mechanism as :var
references, thus the input data may come from a table, or
another source block, and it is initially available as an elisp
data structure.
</li>
<li>
We introduce a new #+ line, e.g.  #+BABELDO. C-c C-c on that
line will apply an <b>action</b> to the referenced data.
</li>
<li>
<b>Actions correspond to source blocks</b>: our library of available
actions will be a library of org-babel source blocks. Thus the
code for executing an action, and the code for dealing with the
output of the action will be the same code as for executing
source blocks in general
</li>
<li>
Optionally, the user can have the relevant source block inserted
into the org buffer after the (say) #+BABELDO line. This will
allow the user to fine tune the action by modifying the code
(especially useful for plots).
</li>
<li>
So maybe a #+BABELDO line will have header args
<ul>
<li>
:data (a reference to a table or source code block)
</li>
<li>
:action (or should that be :srcname?) which will be something
like :action pie-chart, referring to a source block which will
be executed with the :data referent passed in using a :var arg.
</li>
<li>
:showcode or something controlling whether to show the code

</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.35.5" class="outline-4">
<h4 id="sec-1.35.5">Modification to design </h4>
<div class="outline-text-4" id="text-1.35.5">

<p>I'm implementing this, at least initially, as a new interpreter
named 'babel', which has an empty body. 'babel' blocks take
a :srcname header arg, and look for the source-code block with
that name. They then execute the referenced block, after first
appending their own header args on to the target block's header
args.
</p>
<p>
If the target block is in the library of babel (a.o.t. e.g. the
current buffer), then the code in the block will refer to the
input data with a name dictated by convention (e.g. _<sub>data</sub>__
(something which is syntactically legal in all languages&hellip;). Thus
the babel block will use a :var _<sub>data</sub>__ = whatever header arg to
reference the data to be plotted.
</p>
</div>
</div>

</div>

<div id="outline-container-1.36" class="outline-3">
<h3 id="sec-1.36"><span class="done DONE"> DONE</span> Column names in R input/output </h3>
<div class="outline-text-3" id="text-1.36">

<p>This has been implemented: Automatic on input to R; optional in
output. Note that this equates column names with the header row in
an org table; whereas org actually has a mechanism whereby a row
with a '!' in the first field defines column names. I have not
attempted to support these org table mechanisms yet. See <a href="#sec-1.18">this DEFERRED todo item</a>.
</p></div>

</div>

<div id="outline-container-1.37" class="outline-3">
<h3 id="sec-1.37"><span class="done DONE"> DONE</span> use example block for large amounts of stdout output? </h3>
<div class="outline-text-3" id="text-1.37">

<p>We're currently `examplizing' with : at the beginning of the line,
but should larger amounts of output be in a
\#+begin<sub>example&hellip</sub>;\#+end<sub>example</sub> block? What's the cutoff? &gt; 1
line?  This would be nice as it would allow folding of lengthy
output. Sometimes one will want to see stdout just to check
everything looks OK, and then fold it away.
</p>
<p>
I'm addressing this in branch 'examplizing-output'.
Yea, that makes sense.  (either that or allow folding of large
blocks escaped with <code>:</code>).
</p>
<p>
Proposed cutoff of 10 lines, we can save this value in a user
customizable variable.
</p>
</div>

<div id="outline-container-1.37.1" class="outline-4">
<h4 id="sec-1.37.1"><span class="done DONE"> DONE</span> add ability to remove such results </h4>
<div class="outline-text-4" id="text-1.37.1">

</div>
</div>

</div>

<div id="outline-container-1.38" class="outline-3">
<h3 id="sec-1.38"><span class="done DONE"> DONE</span> exclusive <code>exports</code> params </h3>
<div class="outline-text-3" id="text-1.38">





<div class="org-src-container"><label class="org-src-name">implement-export-exclusivity()</label><pre class="src src-ruby">
<span class="org-constant">:this_is_a_test</span>
</pre></div>




<pre class="example">
:this_is_a_test
</pre>

</div>

</div>

<div id="outline-container-1.39" class="outline-3">
<h3 id="sec-1.39"><span class="done DONE"> DONE</span> LoB: allow output in buffer </h3>
<div class="outline-text-3" id="text-1.39">

</div>

</div>

<div id="outline-container-1.40" class="outline-3">
<h3 id="sec-1.40"><span class="done DONE"> DONE</span> allow default header arguments by language </h3>
<div class="outline-text-3" id="text-1.40">

<p>org-babel-default-header-args:lang-name
</p>
<p>
An example of when this is useful is for languages which always return
files as their results (e.g. <a href="#***==ditaa">ditaa</a>, and <a href="#***==gnuplot">gnuplot</a>).
</p></div>

</div>

<div id="outline-container-1.41" class="outline-3">
<h3 id="sec-1.41"><span class="done DONE"> DONE</span> singe-function tangling and loading elisp from literate org-mode file [3/3] </h3>
<div class="outline-text-3" id="text-1.41">


<p>
This function should tangle the org-mode file for elisp, and then call
`load-file' on the resulting tangled file.
</p>



<div class="org-src-container"><label class="org-src-name">test-loading-embedded-emacs-lisp()</label><pre class="src src-emacs-lisp">
<span class="org-esk-paren">(</span>setq test-tangle-advert nil<span class="org-esk-paren">)</span>
<span class="org-esk-paren">(</span>setq test-tangle-loading nil<span class="org-esk-paren">)</span>
<span class="org-esk-paren">(</span>setq results <span class="org-esk-paren">(</span>list <span class="org-builtin">:before</span> test-tangle-loading test-tangle-advert<span class="org-esk-paren">))</span>
<span class="org-esk-paren">(</span>org-babel-load-file <span class="org-string">"test-tangle.org"</span><span class="org-esk-paren">)</span>
<span class="org-esk-paren">(</span>setq results <span class="org-esk-paren">(</span>list <span class="org-esk-paren">(</span>list <span class="org-builtin">:after</span> test-tangle-loading test-tangle-advert<span class="org-esk-paren">)</span> results<span class="org-esk-paren">))</span>
<span class="org-esk-paren">(</span>delete-file <span class="org-string">"test-tangle.el"</span><span class="org-esk-paren">)</span>
<span class="org-esk-paren">(</span>reverse results<span class="org-esk-paren">)</span>
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>:before</td><td>nil</td><td>nil</td></tr>
<tr><td>:after</td><td>"org-babel tangles"</td><td>"use org-babel-tangle for all your emacs initialization files!!"</td></tr>
</tbody>
</table>



</div>

<div id="outline-container-1.41.1" class="outline-4">
<h4 id="sec-1.41.1"><span class="done DONE"> DONE</span> add optional language limiter to org-babel-tangle </h4>
<div class="outline-text-4" id="text-1.41.1">

<p>This should check to see if there is any need to re-export
</p>
</div>

</div>

<div id="outline-container-1.41.2" class="outline-4">
<h4 id="sec-1.41.2"><span class="done DONE"> DONE</span> ensure that org-babel-tangle returns the path to the tangled file(s) </h4>
<div class="outline-text-4" id="text-1.41.2">





<div class="org-src-container"><label class="org-src-name">test-return-value-of-org-babel-tangle()</label><pre class="src src-emacs-lisp">
<span class="org-esk-paren">(</span>mapcar #'file-name-nondirectory <span class="org-esk-paren">(</span>org-babel-tangle-file <span class="org-string">"test-tangle.org"</span> <span class="org-string">"emacs-lisp"</span><span class="org-esk-paren">))</span>
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" />
</colgroup>
<tbody>
<tr><td>"test-tangle.el"</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.41.3" class="outline-4">
<h4 id="sec-1.41.3"><span class="done DONE"> DONE</span> only tangle the file if it's actually necessary </h4>
<div class="outline-text-4" id="text-1.41.3">

</div>
</div>

</div>

<div id="outline-container-1.42" class="outline-3">
<h3 id="sec-1.42"><span class="done DONE"> DONE</span> add a function to jump to a source-block by name </h3>
<div class="outline-text-3" id="text-1.42">

<p>I've had an initial stab at that in org-babel-find-named-block
(library-of-babel branch).
</p>
<p>
At the same time I introduced org-babel-named-src-block-regexp, to
match src-blocks with srcname.
</p>
<p>
This is now working with the command
`org-babel-goto-named-source-block', all we need is a good key
binding.
</p>
</div>

</div>

<div id="outline-container-1.43" class="outline-3">
<h3 id="sec-1.43"><span class="done DONE"> DONE</span> add <code>:none</code> session argument (for purely functional execution) [4/4] </h3>
<div class="outline-text-3" id="text-1.43">

<p>This would allow source blocks to be run in their own new process
</p>
<ul>
<li>
These blocks could then also be run in the background (since we can
detach and just wait for the process to signal that it has terminated)
</li>
<li>
We wouldn't be drowning in session buffers after running the tests
</li>
<li>
we can re-use much of the session code to run in a more <i>functional</i>
mode

</li>
</ul>

<p>While session provide a lot of cool features, like persistent
environments, <a href="#sec-1.45.8">pop-to-session</a>, and hints at exportation for
org-babel-tangle, they also have some down sides and I'm thinking that
session-based execution maybe shouldn't be the default behavior.
</p>
<p>
Down-sides to sessions
</p><ul>
<li>
<b>much</b> more complicated than functional evaluation
<ul>
<li>
maintaining the state of the session has weird issues
</li>
<li>
waiting for evaluation to finish
</li>
<li>
prompt issues like <a href="#*==TODO==weird==escaped==characters==in==shell==prompt==break==shell==evaluation">shell-prompt-escapes-bug</a>
</li>
</ul>
</li>
<li>
can't run in background
</li>
<li>
litter emacs with session buffers

</li>
</ul>

</div>

<div id="outline-container-1.43.1" class="outline-4">
<h4 id="sec-1.43.1"><span class="done DONE"> DONE</span> ruby </h4>
<div class="outline-text-4" id="text-1.43.1">





<div class="org-src-container"><label class="org-src-name">ruby-task-no-session()</label><pre class="src src-ruby">
puts <span class="org-constant">:eric</span>
puts <span class="org-constant">:schulte</span>
[1, 2, 3]
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" />
</colgroup>
<tbody>
<tr><td>"eric"</td></tr>
<tr><td>"schulte"</td></tr>
</tbody>
</table>

</div>

</div>

<div id="outline-container-1.43.2" class="outline-4">
<h4 id="sec-1.43.2"><span class="done DONE"> DONE</span> python </h4>
<div class="outline-text-4" id="text-1.43.2">





<div class="org-src-container"><label class="org-src-name">task-python-none-session()</label><pre class="src src-python">
<span class="org-keyword">print</span> <span class="org-string">'something'</span>
<span class="org-keyword">print</span> <span class="org-string">'output'</span>
[1, 2, 3]
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td><td>3</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.43.3" class="outline-4">
<h4 id="sec-1.43.3"><span class="done DONE"> DONE</span> sh </h4>
<div class="outline-text-4" id="text-1.43.3">





<div class="org-src-container"><label class="org-src-name">task-session-none-sh()</label><pre class="src src-sh">
<span class="org-builtin">echo</span> <span class="org-string">"first"</span>
<span class="org-builtin">echo</span> <span class="org-string">"second"</span>
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" />
</colgroup>
<tbody>
<tr><td>"first"</td></tr>
<tr><td>"second"</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.43.4" class="outline-4">
<h4 id="sec-1.43.4"><span class="done DONE"> DONE</span> R </h4>
<div class="outline-text-4" id="text-1.43.4">





<div class="org-src-container"><label class="org-src-name">task-no-session-R()</label><pre class="src src-R">
a <span class="org-constant">&lt;-</span> 8
b <span class="org-constant">&lt;-</span> 9
a + b
b - a
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>"<sup><a class="footref" name="fnr.1" href="#fn.1">1</a></sup>"</td><td>17</td></tr>
<tr><td>"<sup><a class="footref" name="fnr.1.2" href="#fn.1">1</a></sup>"</td><td>1</td></tr>
</tbody>
</table>


</div>
</div>

</div>

<div id="outline-container-1.44" class="outline-3">
<h3 id="sec-1.44"><span class="done DONE"> DONE</span> fully purge org-babel-R of direct comint interaction </h3>
<div class="outline-text-3" id="text-1.44">

<p>try to remove all code under the <a href="lisp/org-babel-R.el">;; functions for evaluation of R code</a> line
</p>
</div>

</div>

<div id="outline-container-1.45" class="outline-3">
<h3 id="sec-1.45"><span class="done DONE"> DONE</span> Create objects in top level (global) environment [5/5] </h3>
<div class="outline-text-3" id="text-1.45">

<p><b>sessions</b>
</p>

</div>

<div id="outline-container-1.45.1" class="outline-4">
<h4 id="sec-1.45.1">initial requirement statement [DED] </h4>
<div class="outline-text-4" id="text-1.45.1">

<p>At the moment, objects created by computations performed in the
code block are evaluated in the scope of the
code-block-function-body and therefore disappear when the code
block is evaluated {unless you employ some extra trickery like
assign('name', object, env=globalenv()) }. I think it will be
desirable to also allow for a style wherein objects that are
created in one code block persist in the R global environment and
can be re-used in a separate block.
</p>
<p>
This is what Sweave does, and while I'm not saying we have to be
the same as Sweave, it wouldn't be hard for us to provide the same
behaviour in this case; if we don't, we risk undeservedly being
written off as an oddity by some.
</p>
<p>
IOW one aspect of org-babel is that of a sort of functional
meta-programming language. This is crazy, in a very good
way. Nevertheless, wrt R I think there's going to be a lot of value
in providing for a working style in which the objects are stored in
the R session, rather than elisp/org buffer. This will be a very
familiar working style to lots of people.
</p>
<p>
There are no doubt a number of different ways of accomplishing
this, the simplest being a hack like adding
</p>



<pre class="src src-R"><span class="org-keyword">for</span>(objname <span class="org-keyword">in</span> ls())
    assign(objname, get(objname), envir=globalenv())
</pre>




<p>
to the source code block function body. (Maybe wrap it in an on.exit() call).
</p>
<p>
However this may deserve to be thought about more carefully, perhaps
with a view to having a uniform approach across languages. E.g. shell
code blocks have the same semantics at the moment (no persistence of
variables across code blocks), because the body is evaluated in a new
bash shell process rather than a running shell. And I guess the same
is true for python. However, in both these cases, you could imagine
implementing the alternative in which the body is evaluated in a
persistent interactive session. It's just that it's particularly
natural for R, seeing as both ESS and org-babel evaluate commands in a
single persistent R session.
</p>
</div>

</div>

<div id="outline-container-1.45.2" class="outline-4">
<h4 id="sec-1.45.2">sessions [Eric] </h4>
<div class="outline-text-4" id="text-1.45.2">


<p>
Thanks for bringing this up.  I think you are absolutely correct that we
should provide support for a persistent environment (maybe called a
<b>session</b>) in which to evaluate code blocks.  I think the current setup
demonstrates my personal bias for a functional style of programming
which is certainly not ideal in all contexts.
</p>
<p>
While the R function you mention does look like an elegant solution, I
think we should choose an implementation that would be the same across
all source code types.  Specifically I think we should allow the user to
specify an optional <b>session</b> as a header variable (when not present we
assume a default session for each language).  The session name could be
used to name a comint buffer (like the <b>R</b> buffer) in which all
evaluation would take place (within which variables would retain their
values &ndash;at least once I remove some of the functional method wrappings
currently in place&ndash; ).
</p>
<p>
This would allow multiple environments to be used in the same buffer,
and once this setup was implemented we should be able to fairly easily
implement commands for jumping between source code blocks and the
related session buffers, as well as for dumping the last N commands from
a session into a new or existing source code block.
</p>
<p>
Please let me know if you foresee any problems with this proposed setup,
or if you think any parts might be confusing for people coming from
Sweave.  I'll hopefully find some time to work on this later in the
week.
</p>
</div>

</div>

<div id="outline-container-1.45.3" class="outline-4">
<h4 id="sec-1.45.3">can functional and interpreted/interactive models coexist? </h4>
<div class="outline-text-4" id="text-1.45.3">


<p>
Even though both of these use the same <code>*R*</code> buffer the value of <code>a</code>
is not preserved because it is assigned inside of a functional
wrapper.
</p>



<div class="org-src-container"><label class="org-src-name">task-R-sessions()</label><pre class="src src-R">
a <span class="org-constant">&lt;-</span> 9
b <span class="org-constant">&lt;-</span> 21
a + b
</pre></div>





<div class="org-src-container"><label class="org-src-name">task-R-same-session()</label><pre class="src src-R">
a
</pre></div>




<p>
This functional wrapper was implemented in order to efficiently return
the results of the execution of the entire source code block.  However
it inhibits the evaluation of source code blocks in the top level,
which would allow for persistence of variable assignment across
evaluations.  How can we allow <b>both</b> evaluation in the top level, and
efficient capture of the return value of an entire source code block
in a language independent manner?
</p>
<p>
Possible solutions&hellip;
</p><ol>
<li>
we can't so we will have to implement two types of evaluation
depending on which is appropriate (functional or imperative)
</li>
<li>
we remove the functional wrapper and parse the source code block
into it's top level statements (most often but not always on line
breaks) so that we can isolate the final segment which is our
return value.
</li>
<li>
we add some sort of "#+return" line to the code block
</li>
<li>
we take advantage of each languages support for meta-programming
through <code>eval</code> type functions, and use said to evaluate the entire
blocks in such a way that their environment can be combined with the
global environment, and their results are still captured.
</li>
<li>
I believe that most modern languages which support interactive
sessions have support for a <code>last_result</code> type function, which
returns the result of the last input without re-calculation.  If
widely enough present this would be the ideal solution to a
combination of functional and imperative styles.

</li>
</ol>

<p>None of these solutions seem very desirable, but for now I don't see
what else would be possible.
</p>
<p>
Of these options I was leaning towards (1) and (4) but now believe
that if it is possible option (5) will be ideal.
</p>
<ul>
<li id="sec-1.45.3.1">(1) both functional and imperative evaluation <br/>
Pros
<ul>
<li>
can take advantage of built in functions for sending regions to the
inferior process
</li>
<li>
retains the proven tested and working functional wrappers

</li>
</ul>

<p>Cons
</p><ul>
<li>
introduces the complication of keeping track of which type of
evaluation is best suited to a particular context
</li>
<li>
the current functional wrappers may require some changes in order to
include the existing global context

</li>
</ul>
</li>
<li id="sec-1.45.3.2">(4) exploit language meta-programming constructs to explicitly evaluate code <br/>
Pros
<ul>
<li>
only one type of evaluation

</li>
</ul>

<p>Cons
</p><ul>
<li>
some languages may not have sufficient meta-programming constructs

</li>
</ul>
</li>
<li id="sec-1.45.3.3">(5) exploit some <code>last_value</code> functionality if present <br/>

<p>
Need to ensure that most languages have such a function, those without
will simply have to implement their own similar solution&hellip;
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">language</th><th scope="col"><code>last_value</code> function</th></tr>
</thead>
<tbody>
<tr><td>R</td><td>.Last.value</td></tr>
<tr><td>ruby</td><td>_</td></tr>
<tr><td>python</td><td>_</td></tr>
<tr><td>shell</td><td>see <a href="#sec-1.45.3.3.1">last command for shells</a></td></tr>
<tr><td>emacs-lisp</td><td>see <a href="#sec-1.45.3.3.2">special-case</a></td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">task-last-value()</label><pre class="src src-ruby">
82 + 18
</pre></div>




<ul>
<li id="sec-1.45.3.3.1">last command for shells <br/>
Do this using the <code>tee</code> shell command, and continually pipe the output
to a file.

<p>
Got this idea from the following <a href="http://linux.derkeiler.com/Mailing-Lists/Fedora/2004-01/0898.html">email-thread</a>.
</p>
<p>
suggested from mailing list
</p>



<div class="org-src-container"><label class="org-src-name">bash-save-last-output-to-file()</label><pre class="src src-sh">
<span class="org-keyword">while </span><span class="org-builtin">read</span> line 
<span class="org-keyword">do</span> 
  bash -c <span class="org-string">"$line"</span> | tee /tmp/last.out1 
  mv /tmp/last.out1 /tmp/last.out 
<span class="org-keyword">done</span>
</pre></div>




<p>
another proposed solution from the above thread
</p>



<div class="org-src-container"><label class="org-src-name">bash-save-in-variable()</label><pre class="src src-sh">
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment"> 
</span><span class="org-comment-delimiter"># </span><span class="org-comment">so - Save Output. Saves output of command in OUT shell variable. 
</span><span class="org-variable-name">OUT</span>=<span class="org-sh-quoted-exec">`$*`</span> 
<span class="org-builtin">echo</span> $<span class="org-variable-name">OUT</span> 
</pre></div>




<p>
and another
</p>
<blockquote>

<p>.inputrc: 
"<sup>[k</sup>": accept-line 
"<sup>M</sup>": " | tee /tmp/h<sub>lastcmd</sub>.out <sup>[k</sup>" 
</p>
<p>
.bash<sub>profile</sub>: 
export __=/tmp/h<sub>lastcmd</sub>.out 
</p>
<p>
If you try it, Alt-k will stand for the old Enter; use "command $__" to 
access the last output. 
</p>
<p>
Best, 
</p>
<p>
--
</p>
<p>
Herculano de Lima Einloft Neto
</p>
</blockquote>


</li>
<li id="sec-1.45.3.3.2">emacs-lisp will be a special case <br/>
While it is possible for emacs-lisp to be run in a console type
environment (see the <code>elim</code> function) it is <b>not</b> possible to run
emacs-lisp in a different <b>session</b>.  Meaning any variable set top
level of the console environment will be set <b>everywhere</b> inside
emacs.  For this reason I think that it doesn't make any sense to
worry about session support for emacs-lisp.

</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.45.4" class="outline-4">
<h4 id="sec-1.45.4">Further thoughts on 'scripting' vs. functional approaches </h4>
<div class="outline-text-4" id="text-1.45.4">


<p>
These are just thoughts, I don't know how sure I am about this.
And again, perhaps I'm not saying anything very radical, just that
it would be nice to have some options supporting things like
receiving text output in the org buffer.
</p>
<p>
I can see that you've already gone some way down the road towards
the 'last value' approach, so sorry if my comments come rather
late. I am concerned that we are not giving sufficient attention
to stdout / the text that is returned by the interpreters. In
contrast, many of our potential users will be accustomed to a
'scripting' approach, where they are outputting text at various
points in the code block, not just at the end. I am leaning
towards thinking that we should have 2 modes of evaluation:
'script' mode, and 'functional' mode.
</p>
<p>
In script mode, evaluation of a code block would result in <b>all</b>
text output from that code block appearing as output in the org
buffer, presumably as an #+begin<sub>example&hellip</sub>;#+end<sub>example</sub>. There
could be an :echo option controlling whether the input commands
also appear in the output. [This is like Sweave].
</p>
<p>
In functional mode, the <b>result</b> of the code block is available as
an elisp object, and may appear in the org buffer as an org
table/string, via the mechanisms you have developed already.
</p>
<p>
One thing I'm wondering about is whether, in script mode, there
simply should not be a return value. Perhaps this is not so
different from what exists: script mode would be new, and what
exists currently would be functional mode.
</p>
<p>
I think it's likely that, while code evaluation will be exciting
to people, a large majority of our users in a large majority of
their usage will not attempt to actually use the return value from
a source code block in any meaningful way. In that case, it seems
rather restrictive to only allow them to see output from the end
of the code block.
</p>
<p>
Instead I think the most accessible way to introduce org-babel to
people, at least while they are learning it, is as an immensely
powerful environment in which to embed their 'scripts', which now
also allows them to 'run' their 'scripts'. Especially as such
people are likely to be the least capable of the user-base, a
possible design-rule would be to make the scripting style of usage
easy (default?), perhaps requiring a special option to enable a
functional style. Those who will use the functional style won't
have a problem understanding what's going on, whereas the 'skript
kiddies' might not even know the syntax for defining a function in
their language of choice. And of course we can allow the user to
set a variable in their .emacs controlling the preference, so that
functional users are not inconveniennced by having to provide
header args the whole time.
</p>
<p>
Please don't get the impression that I am down-valuing the
functional style of org-babel. I am constantly horrified at the
messy 'scripts' that my colleagues produce in perl or R or
whatever! Nevertheless that seems to be how a lot of people work.
</p>
<p>
I think you were leaning towards the last-value approach because
it offered the possibility of unified code supporting both the
single evaluation environment and the functional style. If you
agree with any of the above then perhaps it will impact upon this
and mean that the code in the two branches has to differ a bit. In
that case, functional mode could perhaps after all evaluate each
code block in its own environment, thus (re)approaching 'true'
functional programming (side-effects are hard to achieve).
</p>



<pre class="src src-sh">ls &gt; files
<span class="org-builtin">echo</span> <span class="org-string">"There are `wc -l files` files in this directory"</span>

</pre>




</div>

</div>

<div id="outline-container-1.45.5" class="outline-4">
<h4 id="sec-1.45.5">even more thoughts on evaluation, results, models and options </h4>
<div class="outline-text-4" id="text-1.45.5">


<p>
Thanks Dan, These comments are invaluable.
</p>
<p>
What do you think about this as a new list of priorities/requirements
for the execution of source-code blocks.
</p>
<ul>
<li>
Sessions
<ol>
<li>
 we want the evaluation of the source code block to take place in a
session which can persist state (variables, current directory,
etc&hellip;).
</li>
<li>
 source code blocks can specify their session with a header argument
</li>
<li>
 each session should correspond to an Emacs comint buffer so that the
user can drop into the session and experiment with live code
evaluation.
</li>
</ol>
</li>
<li>
Results
<ol>
<li>
each source-code block generates some form of results which (as
we have already implemented) is transfered into emacs-lisp
after which it can be inserted into the org-mode buffer, or
used by other source-code blocks
</li>
<li>
when the results are translated into emacs-lisp, forced to be
interpreted as a scalar (dumping their raw values into the
org-mode buffer), as a vector (which is often desirable with R
code blocks), or interpreted on the fly (the default option).
Note that this is very nearly currently implemented through the
<a href="#sec-1.53">results-type-header</a>.
</li>
<li>
there should be <b>two</b> means of collecting results from the
execution of a source code block.  <b>Either</b> the value of the
last statement of the source code block, or the collection of
all that has been passed to STDOUT during the evaluation.

</li>
</ol>
</li>
<li id="sec-1.45.5.1">header argument or return line (<b>header argument</b>) <br/>

<p>
Rather than using a header argument to specify how the return value
should be passed back, I'm leaning towards the use of a <code>#+RETURN</code>
line inside the block.  If such a line <b>is not present</b> then we
default to using STDOUT to collect results, but if such a line <b>is    present</b> then we use it's value as the results of the block.  I
think this will allow for the most elegant specification between
functional and script execution.  This also cleans up some issues
of implementation and finding which statement is the last
statement.
</p>
<p>
Having given this more thought, I think a header argument is
preferable.  The <code>#+return:</code> line adds new complicating syntax for
something that does little more than we would accomplish through
the addition of a header argument.  The only benefit being that we
know where the final statement starts, which is not an issue in
those languages which contain 'last value' operators.
</p>
<p>
new header <code>:results</code> arguments
</p><dl>
<dt>script</dt><dd>
explicitly states that we want to use STDOUT to
initialize our results
</dd>
<dt>return<sub>last</sub></dt><dd>
stdout is ignored instead the <b>value</b> of the final
statement in the block is returned
</dd>
<dt>echo</dt><dd>
means echo the contents of the source-code block along
with the results (this implies the <b>script</b> <code>:results</code>
argument as well)

</dd>
</dl>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.45.6" class="outline-4">
<h4 id="sec-1.45.6"><span class="done DONE"> DONE</span> rework evaluation lang-by-lang [4/4] </h4>
<div class="outline-text-4" id="text-1.45.6">


<p>
This should include&hellip;
</p><ul>
<li>
functional results working with the comint buffer
</li>
<li>
results headers
<dl>
<dt>script</dt><dd>
return the output of STDOUT
<ul>
<li>
write a macro which runs the first redirection, executes the
body, then runs the second redirection
</li>
</ul>
</dd>
<dt>last</dt><dd>
return the value of the last statement
<ul>
</ul>
</dd>
</dl>
</li>
<li>
sessions in comint buffers

</li>
<li id="sec-1.45.6.1"><span class="done DONE"> DONE</span> Ruby [4/4] <br/>
<ul>
<li>
<b>[X]</b> functional results working with comint
</li>
<li>
<b>[X]</b> script results
</li>
<li>
<b>[X]</b> ensure scalar/vector results args are taken into consideration
</li>
<li>
<b>[X]</b> ensure callable by other source block


</li>
</ul>


<div class="org-src-container"><label class="org-src-name">ruby-use-last-output()</label><pre class="src src-ruby">
a = 2
b = 4
c = a + b
[a, b, c, 78]
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>2</td><td>4</td><td>6</td><td>78</td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">task-call-use-last-output(last=ruby-use-last-output)</label><pre class="src src-ruby">
last.flatten.size + 1
</pre></div>




<pre class="example">
5
</pre>


<ul>
<li id="sec-1.45.6.1.1">ruby sessions <br/>




<div class="org-src-container"><label class="org-src-name">first-ruby-session-task()</label><pre class="src src-ruby">
schulte = 27
</pre></div>





<div class="org-src-container"><label class="org-src-name">second-ruby-session-task()</label><pre class="src src-ruby">
schulte + 3
</pre></div>





<div class="org-src-container"><label class="org-src-name">without-the-right-session()</label><pre class="src src-ruby">
schulte
</pre></div>




</li>
</ul>
</li>
<li id="sec-1.45.6.2"><span class="done DONE"> DONE</span> R [4/4] <br/>

<ul>
<li>
<b>[X]</b> functional results working with comint
</li>
<li>
<b>[X]</b> script results
</li>
<li>
<b>[X]</b> ensure scalar/vector results args are taken into consideration
</li>
<li>
<b>[X]</b> ensure callable by other source block

</li>
</ul>

<p>To redirect output to a file, you can use the <code>sink()</code> command.
</p>



<div class="org-src-container"><label class="org-src-name">task_R_B()</label><pre class="src src-R">
a <span class="org-constant">&lt;-</span> 9
b <span class="org-constant">&lt;-</span> 10
b - a
a + b
</pre></div>





<div class="org-src-container"><label class="org-src-name">task-R-use-other-output(twoentyseven=task_R_B())</label><pre class="src src-R">
83
twoentyseven + 9
</pre></div>




<pre class="example">
28
</pre>


</li>
<li id="sec-1.45.6.3"><span class="done DONE"> DONE</span> Python [4/4] <br/>
<ul>
<li>
<b>[X]</b> functional results working with comint
</li>
<li>
<b>[X]</b> script results
</li>
<li>
<b>[X]</b> ensure scalar/vector results args are taken into consideration
</li>
<li>
<b>[X]</b> ensure callable by other source block


</li>
</ul>


<div class="org-src-container"><label class="org-src-name">task-new-eval-for-python()</label><pre class="src src-python">
8
9
10
</pre></div>





<div class="org-src-container"><label class="org-src-name">task-use-new-eval(tasking=task-new-eval-for-python())</label><pre class="src src-python">
tasking + 2
</pre></div>




<pre class="example">
12
</pre>


</li>
<li id="sec-1.45.6.4"><span class="done DONE"> DONE</span> Shells [4/4] <br/>
<ul>
<li>
<b>[X]</b> functional results working with comint
</li>
<li>
<b>[X]</b> script results
</li>
<li>
<b>[X]</b> ensure scalar/vector results args are taken into consideration
</li>
<li>
<b>[X]</b> ensure callable by other source block


</li>
</ul>


<div class="org-src-container"><label class="org-src-name">task-shell-new-evaluation()</label><pre class="src src-sh">
<span class="org-builtin">echo</span> <span class="org-string">'eric'</span>
date
</pre></div>





<div class="org-src-container"><label class="org-src-name">task-call-other-shell(other=task-shell-new-evaluation())</label><pre class="src src-sh">
<span class="org-builtin">echo</span> $<span class="org-variable-name">other</span> <span class="org-string">' is the old date'</span>
</pre></div>




<pre class="example">
$ Fri Jun 12 13:08:37 PDT 2009  is the old date
</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-1.45.7" class="outline-4">
<h4 id="sec-1.45.7"><span class="done DONE"> DONE</span> implement a <b>session</b> header argument [4/4] </h4>
<div class="outline-text-4" id="text-1.45.7">

<p><code>:session</code> header argument to override the default <b>session</b> buffer
</p>
<ul>
<li id="sec-1.45.7.1"><span class="done DONE"> DONE</span> ruby <br/>




<div class="org-src-container"><label class="org-src-name">task-ruby-named-session()</label><pre class="src src-ruby">
schulte = <span class="org-constant">:in_schulte</span>
</pre></div>




<pre class="example">
:in_schulte
</pre>





<div class="org-src-container"><label class="org-src-name">another-in-schulte()</label><pre class="src src-ruby">
schulte
</pre></div>




<pre class="example">
:in_schulte
:in_schulte
:in_schulte
</pre>


</li>
<li id="sec-1.45.7.2"><span class="done DONE"> DONE</span> python <br/>




<div class="org-src-container"><label class="org-src-name">python-session-task()</label><pre class="src src-python">
<span class="org-variable-name">what</span> = 98
</pre></div>





<div class="org-src-container"><label class="org-src-name">python-get-from-session()</label><pre class="src src-python">
what
</pre></div>




<pre class="example">
98
</pre>


</li>
<li id="sec-1.45.7.3"><span class="done DONE"> DONE</span> shell <br/>




<div class="org-src-container"><label class="org-src-name">task-shell-sessions()</label><pre class="src src-sh">
<span class="org-variable-name">WHAT</span>=<span class="org-string">'patton'</span>
</pre></div>





<div class="org-src-container"><label class="org-src-name">task-shell-sessions-what()</label><pre class="src src-sh">
<span class="org-builtin">echo</span> $<span class="org-variable-name">WHAT</span>
</pre></div>




<pre class="example">
patton
</pre>


</li>
<li id="sec-1.45.7.4"><span class="done DONE"> DONE</span> R <br/>




<div class="org-src-container"><label class="org-src-name">task-R-session()</label><pre class="src src-R">
a <span class="org-constant">&lt;-</span> 9
b <span class="org-constant">&lt;-</span> 8
a + b
</pre></div>




<pre class="example">
17
</pre>





<div class="org-src-container"><label class="org-src-name">another-task-R-session()</label><pre class="src src-R">
a + b
</pre></div>




</li>
</ul>
</div>

</div>

<div id="outline-container-1.45.8" class="outline-4">
<h4 id="sec-1.45.8"><span class="done DONE"> DONE</span> function to bring up inferior-process buffer [4/4] </h4>
<div class="outline-text-4" id="text-1.45.8">


<p>
This should be callable from inside of a source-code block in an
org-mode buffer.  It should evaluate the header arguments, then bring
up the inf-proc buffer using <code>pop-to-buffer</code>.
</p>
<p>
For lack of a better place, lets add this to the `org-metadown-hook'
hook.
</p>
<p>
To give this a try, place the cursor on a source block with variables,
(optionally git a prefix argument) then hold meta and press down.
</p>
<ul>
<li id="sec-1.45.8.1"><span class="done DONE"> DONE</span> ruby <br/>




<div class="org-src-container"><label class="org-src-name">task-ruby-pop-to-session(num=9, another="something else")</label><pre class="src src-ruby">
num.times{|n| puts another}
</pre></div>




</li>
<li id="sec-1.45.8.2"><span class="done DONE"> DONE</span> python <br/>




<div class="org-src-container"><label class="org-src-name">task-python-pop-to-session(num=9, another="something else")</label><pre class="src src-python">
another * num
</pre></div>



</li>
<li id="sec-1.45.8.3"><span class="done DONE"> DONE</span> R <br/>




<div class="org-src-container"><label class="org-src-name">task-R-pop-to-session(a=9, b=8)</label><pre class="src src-R">
a * b
</pre></div>




</li>
<li id="sec-1.45.8.4"><span class="done DONE"> DONE</span> shell <br/>




<div class="org-src-container"><label class="org-src-name">task-shell-pop-sessions(NAME="eric")</label><pre class="src src-sh">
<span class="org-builtin">echo</span> $<span class="org-variable-name">NAME</span>
</pre></div>




</li>
</ul>
</div>

</div>

<div id="outline-container-1.45.9" class="outline-4">
<h4 id="sec-1.45.9"><span class="done DEFERRED"> DEFERRED</span> function to dump last N lines from inf-proc buffer into the current source block </h4>
<div class="outline-text-4" id="text-1.45.9">


<p>
Callable with a prefix argument to specify how many lines should be
dumped into the source-code buffer.
</p>
</div>

</div>

<div id="outline-container-1.45.10" class="outline-4">
<h4 id="sec-1.45.10"><span class="done REJECTED"> REJECTED</span> comint notes </h4>
<div class="outline-text-4" id="text-1.45.10">


<p>
Implementing comint integration in <a href="lisp/org-babel-comint.el">org-babel-comint.el</a>.
</p>
<p>
Need to have&hellip;
</p><ul>
<li>
handling of outputs
<ul>
<li>
split raw output from process by prompts
</li>
<li>
a ring of the outputs, buffer-local, `org-babel-comint-output-ring'
</li>
<li>
a switch for dumping all outputs to a buffer
</li>
</ul>
</li>
<li>
inputting commands

</li>
</ul>

<p>Lets drop all this language specific stuff, and just use
org-babel-comint to split up our outputs, and return either the last
value of an execution or the combination of values from the
executions.
</p>
<ul>
<li id="sec-1.45.10.1">comint filter functions <br/>
<pre class="example">
;;  comint-input-filter-functions     hook    process-in-a-buffer
;;  comint-output-filter-functions    hook    function modes.
;;  comint-preoutput-filter-functions   hook
;;  comint-input-filter                       function ...
</pre>





<div class="org-src-container"><label class="org-src-name">obc-filter-ruby()</label><pre class="src src-ruby">
1
2
3
4
5
</pre></div>




</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-1.46" class="outline-3">
<h3 id="sec-1.46"><span class="done DONE"> DONE</span> Remove protective commas from # comments before evaluating </h3>
<div class="outline-text-3" id="text-1.46">

<p>org inserts protective commas in front of ## comments in language
modes that use them. We need to remove them prior to sending code
to the interpreter.
</p>



<div class="org-src-container"><label class="org-src-name">testing-removal-of-protective-comas()</label><pre class="src src-ruby">
<span class="org-comment-delimiter"># </span><span class="org-comment">this one might break it??
</span><span class="org-constant">:comma_protection</span>
</pre></div>




</div>

</div>

<div id="outline-container-1.47" class="outline-3">
<h3 id="sec-1.47"><span class="done DONE"> DONE</span> pass multiple reference arguments into R </h3>
<div class="outline-text-3" id="text-1.47">

<p>Can we do this? I wasn't sure how to supply multiple 'var' header
args. Just delete this if I'm being dense.
</p>
<p>
This should be working, see the following example&hellip;
</p>



<div class="org-src-container"><label class="org-src-name">two-arg-example(n=2, m=8)</label><pre class="src src-R">
n + m
</pre></div>




<pre class="example">
10
</pre>


</div>

</div>

<div id="outline-container-1.48" class="outline-3">
<h3 id="sec-1.48"><span class="done DONE"> DONE</span> ensure that table ranges work </h3>
<div class="outline-text-3" id="text-1.48">

<p>when a table range is passed to org-babel as an argument, it should be
interpreted as a vector.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td><td>simple</td></tr>
<tr><td>2</td><td>3</td><td>Fixnum:1</td></tr>
<tr><td>3</td><td>4</td><td>Array:123456</td></tr>
<tr><td>4</td><td>5</td><td></td></tr>
<tr><td>5</td><td>6</td><td></td></tr>
<tr><td>6</td><td>7</td><td></td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">simple-sbe-example()</label><pre class="src src-emacs-lisp">
<span class="org-string">"simple"</span>
</pre></div>





<div class="org-src-container"><label class="org-src-name">task-table-range(n=simple-sbe-example)</label><pre class="src src-ruby">
<span class="org-string">"</span><span class="org-variable-name">#{n.class}</span><span class="org-string">:</span><span class="org-variable-name">#{n}</span><span class="org-string">"</span>
</pre></div>





<div class="org-src-container"><label class="org-src-name">simple-results(n=task-table-range(n=(1 2 3)))</label><pre class="src src-emacs-lisp">
n
</pre></div>




<pre class="example">
Array:123
</pre>





<div class="org-src-container"><label class="org-src-name">task-arr-referent(ar=(1 2 3))</label><pre class="src src-ruby">
ar.size
</pre></div>




<pre class="example">
3
</pre>


</div>

</div>

<div id="outline-container-1.49" class="outline-3">
<h3 id="sec-1.49"><span class="done DONE"> DONE</span> global variable indicating default to vector output </h3>
<div class="outline-text-3" id="text-1.49">

<p>how about an alist&hellip; <code>org-babel-default-header-args</code> this may already
exist&hellip; just execute the following and all source blocks will default
to vector output
</p>



<pre class="src src-emacs-lisp"><span class="org-esk-paren">(</span>setq org-babel-default-header-args '<span class="org-esk-paren">((</span><span class="org-builtin">:results</span> . <span class="org-string">"vector"</span><span class="org-esk-paren">)))</span>
</pre>




</div>

</div>

<div id="outline-container-1.50" class="outline-3">
<h3 id="sec-1.50"><span class="done DONE"> DONE</span> name named results if source block is named </h3>
<div class="outline-text-3" id="text-1.50">

<p>currently this isn't happening although it should be
</p>



<div class="org-src-container"><label class="org-src-name">test-naming-named-source-blocks()</label><pre class="src src-emacs-lisp">
<span class="org-builtin">:namer</span>
</pre></div>




<pre class="example">
:namer
</pre>

</div>

</div>

<div id="outline-container-1.51" class="outline-3">
<h3 id="sec-1.51"><span class="done DONE"> DONE</span> (simple caching) check for named results before source blocks </h3>
<div class="outline-text-3" id="text-1.51">

<p>see the TODO comment in <a href="lisp/org-babel-ref.el">org-babel-ref.el#org-babel-ref-resolve-reference</a>
</p></div>

</div>

<div id="outline-container-1.52" class="outline-3">
<h3 id="sec-1.52"><span class="done DONE"> DONE</span> set <code>:results silent</code> when eval with prefix argument </h3>
<div class="outline-text-3" id="text-1.52">





<pre class="src src-emacs-lisp">'silentp
</pre>



</div>

</div>

<div id="outline-container-1.53" class="outline-3">
<h3 id="sec-1.53"><span class="done DONE"> DONE</span> results-type header (vector/file) [3/3] </h3>
<div class="outline-text-3" id="text-1.53">

<p>In response to a point in Dan's email.  We should allow the user to
force scalar or vector results.  This could be done with a header
argument, and the default behavior could be controlled through a
configuration variable.
</p>



<div class="org-src-container"><label class="org-src-name">task-trivial-vector()</label><pre class="src src-ruby">
<span class="org-constant">:scalar</span>
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" />
</colgroup>
<tbody>
<tr><td>":scalar"</td></tr>
</tbody>
</table>


<p>
since it doesn't make sense to turn a vector into a scalar, lets
just add a two values&hellip;
</p>
<dl>
<dt>vector</dt><dd>
forces the results to be a vector (potentially 1 dimensional)
</dd>
<dt>file</dt><dd>
this throws an error if the result isn't a string, and
tries to treat it as a path to a file.

</dd>
</dl>

<p>I'm just going to cram all of these into the <code>:results</code> header
argument.  Then if we allow multiple header arguments it should
work out, for example one possible header argument string could be
<code>:results replace vector file</code>, which would <b>replace</b> any existing
results forcing the results into an org-mode table, and
interpreting any strings as file paths.
</p>

</div>

<div id="outline-container-1.53.1" class="outline-4">
<h4 id="sec-1.53.1"><span class="done DONE"> DONE</span> multiple <code>:results</code> headers </h4>
<div class="outline-text-4" id="text-1.53.1">





<div class="org-src-container"><label class="org-src-name">multiple-result-headers()</label><pre class="src src-ruby">
<span class="org-constant">:schulte</span>
</pre></div>





</div>

</div>

<div id="outline-container-1.53.2" class="outline-4">
<h4 id="sec-1.53.2"><span class="done DONE"> DONE</span> file result types </h4>
<div class="outline-text-4" id="text-1.53.2">

<p>When inserting into an org-mode buffer create a link with the path
being the value, and optionally the display being the
<code>file-name-nondirectory</code> if it exists.
</p>



<div class="org-src-container"><label class="org-src-name">task-file-result()</label><pre class="src src-python">
<span class="org-string">"something"</span>
</pre></div>




<p>
<a href="#sec-1.5.6.3">something</a>
</p>

<p>
This will be useful because blocks like <code>ditaa</code> and <code>dot</code> can return
the string path of their files, and can add <code>file</code> to their results
header.
</p>
</div>

</div>

<div id="outline-container-1.53.3" class="outline-4">
<h4 id="sec-1.53.3"><span class="done DONE"> DONE</span> vector result types </h4>
<div class="outline-text-4" id="text-1.53.3">





<div class="org-src-container"><label class="org-src-name">task-force-results()</label><pre class="src src-emacs-lisp">
8
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" />
</colgroup>
<tbody>
<tr><td>8</td></tr>
</tbody>
</table>


</div>
</div>

</div>

<div id="outline-container-1.54" class="outline-3">
<h3 id="sec-1.54"><span class="done DONE"> DONE</span> results name </h3>
<div class="outline-text-3" id="text-1.54">

<p>In order to do this we will need to start naming our results.
Since the source blocks are named with <code>#+srcname:</code> lines we can
name results with <code>#+resname:</code> lines (if the source block has no
name then no name is given to the <code>#+resname:</code> line on creation,
otherwise the name of the source block is used).
</p>
<p>
This will have the additional benefit of allowing results and
source blocks to be located in different places in a buffer (and
eventually in different buffers entirely).
</p>



<div class="org-src-container"><label class="org-src-name">developing-resnames()</label><pre class="src src-emacs-lisp">
'schulte
</pre></div>




<p>
Once source blocks are able to find their own <code>#+resname:</code> lines
we then need to&hellip;
</p>



<div class="org-src-container"><label class="org-src-name">sbe-w-new-results()</label><pre class="src src-emacs-lisp">
<span class="org-esk-paren">(</span>sbe <span class="org-string">"developing-resnames"</span><span class="org-esk-paren">)</span>
</pre></div>




<pre class="example">
schulte
</pre>



</div>

<div id="outline-container-1.54.1" class="outline-4">
<h4 id="sec-1.54.1"><span class="todo TODO"> TODO</span> change the results insertion functions to use these lines </h4>
<div class="outline-text-4" id="text-1.54.1">


</div>

</div>

<div id="outline-container-1.54.2" class="outline-4">
<h4 id="sec-1.54.2"><span class="todo TODO"> TODO</span> teach references to resolve <code>#+resname</code> lines. </h4>
<div class="outline-text-4" id="text-1.54.2">


</div>
</div>

</div>

<div id="outline-container-1.55" class="outline-3">
<h3 id="sec-1.55"><span class="done DONE"> DONE</span> org-babel tests org-babel [1/1] </h3>
<div class="outline-text-3" id="text-1.55">

<p>since we are accumulating this nice collection of source-code blocks
in the sandbox section we should make use of them as unit tests.
What's more, we should be able to actually use org-babel to run these
tests.
</p>
<p>
We would just need to cycle over every source code block under the
sandbox, run it, and assert that the return value is equal to what we
expect.
</p>
<p>
I have the feeling that this should be possible using only org-babel
functions with minimal or no additional elisp.  It would be very cool
for org-babel to be able to test itself.
</p>
<p>
This is now done, see <a href="#sec-1.55">* Tests</a>.
</p>

</div>

<div id="outline-container-1.55.1" class="outline-4">
<h4 id="sec-1.55.1"><span class="done DEFERRED"> DEFERRED</span> org-babel assertions (may not be necessary) </h4>
<div class="outline-text-4" id="text-1.55.1">

<p>These could be used to make assertions about the results of a
source-code block.  If the assertion fails then the point could be
moved to the block, and error messages and highlighting etc&hellip; could
ensue
</p>
</div>
</div>

</div>

<div id="outline-container-1.56" class="outline-3">
<h3 id="sec-1.56"><span class="done DONE"> DONE</span> make C-c C-c work anywhere within source code block? </h3>
<div class="outline-text-3" id="text-1.56">

<p>This seems like it would be nice to me, but perhaps it would be
inefficient or ugly in implementation? I suppose you could search
forward, and if you find #+end<sub>src</sub> before you find #+begin<sub>src</sub>,
then you're inside one. [DED]
</p>
<p>
Agreed, I think inside of the <code>#+srcname: line</code> would be useful as
well.
</p>



<div class="org-src-container"><label class="org-src-name">testing-out-cc()</label><pre class="src src-emacs-lisp">
'schulte
</pre></div>




</div>

</div>

<div id="outline-container-1.57" class="outline-3">
<h3 id="sec-1.57"><span class="done DONE"> DONE</span> integration with org tables </h3>
<div class="outline-text-3" id="text-1.57">

<p>We should make it easy to call org-babel source blocks from org-mode
table formulas.  This is practical now that it is possible to pass
arguments to org-babel source blocks.
</p>
<p>
See the related <a href="#*==(sandbox)==integration==w/org==tables">sandbox</a> header for tests/examples.
</p>

</div>

<div id="outline-container-1.57.1" class="outline-4">
<h4 id="sec-1.57.1">digging in org-table.el </h4>
<div class="outline-text-4" id="text-1.57.1">

<p>In the past <a href="/home/eschulte/src/org/lisp/org-table.el">org-table.el</a> has proven difficult to work with.
</p>
<p>
Should be a hook in <a href="/home/eschulte/src/org/lisp/org-table.el">org-table-eval-formula</a>.
</p>
<p>
Looks like I need to change this <a href="/home/eschulte/src/org/lisp/org-table.el">if statement</a> (line 2239) into a cond
expression.
</p>
</div>
</div>

</div>

<div id="outline-container-1.58" class="outline-3">
<h3 id="sec-1.58"><span class="done DONE"> DONE</span> source blocks as functions </h3>
<div class="outline-text-3" id="text-1.58">


<p>
Allow source code blocks to be called like functions, with arguments
specified.  We are already able to call a source-code block and assign
it's return result to a variable.  This would just add the ability to
specify the values of the arguments to the source code block assuming
any exist.  For an example see 
</p>
<p>
When a variable appears in a header argument, how do we differentiate
between it's value being a reference or a literal value?  I guess this
could work just like a programming language.  If it's escaped or in
quotes, then we count it as a literal, otherwise we try to look it up
and evaluate it.
</p>
</div>

</div>

<div id="outline-container-1.59" class="outline-3">
<h3 id="sec-1.59"><span class="done DONE"> DONE</span> folding of code blocks? [2/2] </h3>
<div class="outline-text-3" id="text-1.59">

<p>[DED] In similar way to using outline-minor-mode for folding function
bodies, can we fold code blocks?  #+begin whatever statements are
pretty ugly, and in any case when you're thinking about the overall
game plan you don't necessarily want to see the code for each Step.
</p>

</div>

<div id="outline-container-1.59.1" class="outline-4">
<h4 id="sec-1.59.1"><span class="done DONE"> DONE</span> folding of source code block </h4>
<div class="outline-text-4" id="text-1.59.1">

<p>Sounds good, and wasn't too hard to implement.  Code blocks should
now be fold-able in the same manner as headlines (by pressing TAB
on the first line).
</p>
</div>

</div>

<div id="outline-container-1.59.2" class="outline-4">
<h4 id="sec-1.59.2"><span class="done REJECTED"> REJECTED</span> folding of results </h4>
<div class="outline-text-4" id="text-1.59.2">

<p>So, lets do a three-stage tab cycle&hellip; First fold the src block,
then fold the results, then unfold.
</p>
<p>
There's no way to tell if the results are a table or not w/o
actually executing the block which would be too expensive of an
operation.
</p>
</div>
</div>

</div>

<div id="outline-container-1.60" class="outline-3">
<h3 id="sec-1.60"><span class="done DONE"> DONE</span> selective export of text, code, figures </h3>
<div class="outline-text-3" id="text-1.60">

<p>[DED] The org-babel buffer contains everything (code, headings and
notes/prose describing what you're up to, textual/numeric/graphical
code output, etc). However on export to html / LaTeX one might want
to include only a subset of that content. For example you might
want to create a presentation of what you've done which omits the
code.
</p>
<p>
[EMS] So I think this should be implemented as a property which can
be set globally or on the outline header level (I need to review
the mechanics of org-mode properties).  And then as a source block
header argument which will apply only to a specific source code
block.  A header argument of <code>:export</code> with values of
</p>
<dl>
<dt><code>code</code></dt><dd>
just show the code in the source code block
</dd>
<dt><code>none</code></dt><dd>
don't show the code or the results of the evaluation
</dd>
<dt><code>results</code></dt><dd>
just show the results of the code evaluation (don't
show the actual code)
</dd>
<dt><code>both</code></dt><dd>
show both the source code, and the results

</dd>
</dl>

<p>this will be done in <a href="#*==(sandbox)==selective==export">(sandbox) selective export</a>.
</p>
</div>

</div>

<div id="outline-container-1.61" class="outline-3">
<h3 id="sec-1.61"><span class="done DONE"> DONE</span> a header argument specifying silent evaluation (no output) </h3>
<div class="outline-text-3" id="text-1.61">

<p>This would be useful across all types of source block.  Currently
there is a <code>:replace t</code> option to control output, this could be
generalized to an <code>:output</code> option which could take the following
options (maybe more)
</p>
<dl>
<dt><code>t</code></dt><dd>
this would be the default, and would simply insert the
results after the source block
</dd>
<dt><code>replace</code></dt><dd>
to replace any results which may already be there
</dd>
<dt><code>silent</code></dt><dd>
this would inhibit any insertion of the results

</dd>
</dl>

<p>This is now implemented see the example in the <a href="#sec-1.61">sandbox</a>
</p>
</div>

</div>

<div id="outline-container-1.62" class="outline-3">
<h3 id="sec-1.62"><span class="done DONE"> DONE</span> assign variables from tables in R </h3>
<div class="outline-text-3" id="text-1.62">

<p>This is now working (see <a href="#*==(sandbox==table)==R">(sandbox-table)-R</a>).  Although it's not that
impressive until we are able to print table results from R.
</p>
</div>

</div>

<div id="outline-container-1.63" class="outline-3">
<h3 id="sec-1.63"><span class="done DONE"> DONE</span> insert 2-D R results as tables </h3>
<div class="outline-text-3" id="text-1.63">

<p>everything is working but R and shell
</p>

</div>

<div id="outline-container-1.63.1" class="outline-4">
<h4 id="sec-1.63.1"><span class="done DONE"> DONE</span> shells </h4>
<div class="outline-text-4" id="text-1.63.1">


</div>

</div>

<div id="outline-container-1.63.2" class="outline-4">
<h4 id="sec-1.63.2"><span class="done DONE"> DONE</span> R </h4>
<div class="outline-text-4" id="text-1.63.2">


<p>
This has already been tackled by Dan in <a href="existing_tools/org-R.el">org-R:check-dimensions</a>.  The
functions there should be useful in combination with <a href="http://cran.r-project.org/doc/manuals/R-data.html#Export-to-text-files">R-export-to-csv</a>
as a means of converting multidimensional R objects to emacs lisp.
</p>
<p>
It may be as simple as first checking if the data is multidimensional,
and then, if so using <code>write</code> to write the data out to a temporary
file from which emacs can read the data in using <code>org-table-import</code>.
</p>
<p>
Looking into this further, is seems that there is no such thing as a
scalar in R <a href="http://tolstoy.newcastle.edu.au/R/help/03a/3733.html">R-scalar-vs-vector</a>  In that light I am not sure how to
deal with trivial vectors (scalars) in R.  I'm tempted to just treat
them as vectors, but then that would lead to a proliferation of
trivial 1-cell tables&hellip;
</p>
</div>
</div>

</div>

<div id="outline-container-1.64" class="outline-3">
<h3 id="sec-1.64"><span class="done DONE"> DONE</span> allow variable initialization from source blocks </h3>
<div class="outline-text-3" id="text-1.64">

<p>Currently it is possible to initialize a variable from an org-mode
table with a block argument like <code>table=sandbox</code> (note that the
variable doesn't have to named <code>table</code>) as in the following example
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td><td>3</td></tr>
<tr><td>4</td><td>schulte</td><td>6</td></tr>
</tbody>
</table>





<pre class="src src-emacs-lisp"><span class="org-esk-paren">(</span>message <span class="org-esk-paren">(</span>format <span class="org-string">"table = %S"</span> table<span class="org-esk-paren">))</span>
</pre>




<pre class="example">
"table = ((1 2 3) (4 \"schulte\" 6))"
</pre>


<p>
It would be good to allow initialization of variables from the results
of other source blocks in the same manner.  This would probably
require the addition of <code>#+SRCNAME: example</code> lines for the naming of
source blocks, also the <code>table=sandbox</code> syntax may have to be expanded
to specify whether the target is a source code block or a table
(alternately we could just match the first one with the given name
whether it's a table or a source code block).
</p>
<p>
At least initially I'll try to implement this so that there is no need
to specify whether the reference is to a table or a source-code block.
That seems to be simpler both in terms of use and implementation.
</p>
<p>
This is now working for emacs-lisp, ruby and python (and mixtures of
the three) source blocks.  See the examples in the <a href="#*==(sandbox)==referencing==other==source==blocks">sandbox</a>.
</p>
<p>
This is currently working only with emacs lisp as in the following
example in the <a href="#*==emacs==lisp==source==reference">emacs lisp source reference</a>.
</p>

</div>

</div>

<div id="outline-container-1.65" class="outline-3">
<h3 id="sec-1.65"><span class="todo TODO"> TODO</span> Add languages [16/21] </h3>
<div class="outline-text-3" id="text-1.65">

<p>I'm sure there are many more that aren't listed here.  Please add
them, and bubble any that you particularly care about up to the top.
</p>
<p>
Any new language should be implemented in a org-babel-lang.el file.
Follow the pattern set by <a href="lisp/org-babel-shell.el">org-babel-shell.el</a> and <a href="lisp/org-babel-R.el">org-babel-R.el</a>.
</p>

</div>

<div id="outline-container-1.65.1" class="outline-4">
<h4 id="sec-1.65.1"><span class="todo STARTED"> STARTED</span> matlab and octave </h4>
<div class="outline-text-4" id="text-1.65.1">

<ul>
<li>
State "STARTED"    from "TODO" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-16 Tue 19:25</span></span>
</li>
<li>
State "TODO"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-16 Tue 11:02</span></span>
See
<a href="http://www.gnu.org/software/octave/doc/interpreter/Running-Octave-From-Within-Emacs.html#Running-Octave-From-Within-Emacs">http://www.gnu.org/software/octave/doc/interpreter/Running-Octave-From-Within-Emacs.html#Running-Octave-From-Within-Emacs</a>
<a href="http://sourceforge.net/projects/matlab-emacs/">http://sourceforge.net/projects/matlab-emacs/</a>
<a href="http://www.mail-archive.com/emacs-orgmode@gnu.org/msg22268.html">http://www.mail-archive.com/emacs-orgmode@gnu.org/msg22268.html</a>

<p>
non-session :results output is working
</p>
</li>
</ul>

<p>session :results output is getting there
</p>
<p>
With octave, it is hanging at
</p>
<p>
(org-babel-comint-with-output session org-babel-octave-or-matlab-eoe-indicator t
(insert full-body) (comint-send-input nil t))
</p>
<p>
With matlab, that bit goes OK. The remaining problem is processing the
raw output:
</p>
<p>
72*pi
</p>
<p>
72*pi
</p>
<p>
ans =
</p>
<p>
226.1947
</p>
<p>
'org<sub>babel</sub><sub>eoe'</sub>
</p>
<p>
ans =
</p>
<p>
org<sub>babel</sub><sub>eoe</sub>
</p>
<ul>
<li id="sec-1.65.1.1"><span class="todo TODO"> TODO</span> Allow multiple sessions <br/>
<ul>
<li>
State "TODO"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-16 Tue 22:12</span></span>

</li>
</ul>
</li>
<li id="sec-1.65.1.2">matlab options <br/>
Why does a splash screen still appear with -nosplash?


<p>
Should we use these by default to save external process startup time?
</p><ul>
<li>
-nodisplay ?
</li>
<li>
-nojvm ?

</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.65.2" class="outline-4">
<h4 id="sec-1.65.2"><span class="done DONE"> DONE</span> clojure </h4>
<div class="outline-text-4" id="text-1.65.2">

<ul>
<li>
State "DONE"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-01 Mon 10:26</span></span>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.65.3" class="outline-4">
<h4 id="sec-1.65.3"><span class="done DONE"> DONE</span> oz </h4>
<div class="outline-text-4" id="text-1.65.3">

<ul>
<li>
State "DONE"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-01 Mon 10:27</span></span>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.65.4" class="outline-4">
<h4 id="sec-1.65.4"><span class="done DONE"> DONE</span> screen </h4>
<div class="outline-text-4" id="text-1.65.4">

<ul>
<li>
State "DONE"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-01 Mon 10:28</span></span>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.65.5" class="outline-4">
<h4 id="sec-1.65.5"><span class="todo STARTED"> STARTED</span> Haskell </h4>
<div class="outline-text-4" id="text-1.65.5">




<pre class="src src-haskell"><span class="org-string">"hello Haskell"</span>
</pre>




<pre class="example">
hello Haskell
</pre>





<pre class="src src-haskell"><span class="org-keyword">let</span> fac n <span class="org-variable-name">=</span> <span class="org-keyword">if</span> n <span class="org-variable-name">==</span> 0 <span class="org-keyword">then</span> 1 <span class="org-keyword">else</span> n <span class="org-variable-name">*</span> fac (n <span class="org-variable-name">-</span> 1)
<span class="org-function-name">fac</span> 4
</pre>




<pre class="example">
24
</pre>





<pre class="src src-haskell">[1, 2, 3, 4, 5]
</pre>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td></tr>
</tbody>
</table>


<ul>
<li id="sec-1.65.5.1">allow non-interactive evaluation <br/>

</li>
</ul>
</div>

</div>

<div id="outline-container-1.65.6" class="outline-4">
<h4 id="sec-1.65.6"><span class="todo STARTED"> STARTED</span> ocaml [2/3] </h4>
<div class="outline-text-4" id="text-1.65.6">


<ul>
<li>
<b>[X]</b> Working for the simple case (no arguments, simple output)
</li>
<li>
<b>[X]</b> correct handling of vector/list output
</li>
<li>
<b>[<span style="visibility:hidden;">X</span>]</b> ability to import arguments


</li>
</ul>


<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">rec</span> <span class="org-function-name">fib</span><span class="org-variable-name"> x </span><span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-keyword">match</span> x <span class="org-keyword">with</span>
    <span class="org-tuareg-font-lock-operator">|</span> 0 <span class="org-tuareg-font-lock-operator">-&gt;</span> 1
    <span class="org-tuareg-font-lock-operator">|</span> 1 <span class="org-tuareg-font-lock-operator">-&gt;</span> 1
    <span class="org-tuareg-font-lock-operator">|</span> n <span class="org-tuareg-font-lock-operator">-&gt;</span> fib<span class="org-tuareg-font-lock-operator">(</span>n <span class="org-tuareg-font-lock-operator">-</span> 1<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">+</span> fib<span class="org-tuareg-font-lock-operator">(</span>n <span class="org-tuareg-font-lock-operator">-</span> 2<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-governing">in</span>
  fib 12
</pre>




<pre class="example">
233
</pre>





<pre class="src src-ocaml"><span class="org-string">"string"</span>
</pre>




<pre class="example">
"string"
</pre>





<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3<span class="org-tuareg-font-lock-operator">;</span> 4<span class="org-tuareg-font-lock-operator">]</span>
</pre>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>1</td><td>2</td><td>3</td><td>4</td></tr>
</tbody>
</table>





<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">[|</span><span class="org-string">"ocaml"</span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-string">"array"</span><span class="org-tuareg-font-lock-operator">|]</span>
</pre>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>"ocaml"</td><td>"array"</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.65.7" class="outline-4">
<h4 id="sec-1.65.7"><span class="done DONE"> DONE</span> perl </h4>
<div class="outline-text-4" id="text-1.65.7">

<ul>
<li>
State "DONE"       from "TODO" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-01 Mon 05:22</span></span>
</li>
</ul>

<p>This could probably be added to <a href="lisp/org-babel-script.el">org-babel-script.el</a>
</p>
<p>
It has been implemented on its own (for external process only). I
think org-babel-script.el may be obsolete now.
</p>



<pre class="src src-perl">$<span class="org-variable-name">a</span> = <span class="org-string">"1 2 3"</span>;
split <span class="org-string">" "</span>, $<span class="org-variable-name">a</span>;
</pre>



<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" />
</colgroup>
<tbody>
<tr><td>1</td></tr>
<tr><td>2</td></tr>
<tr><td>3</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.65.8" class="outline-4">
<h4 id="sec-1.65.8"><span class="todo TODO"> TODO</span> java </h4>
<div class="outline-text-4" id="text-1.65.8">

</div>

</div>

<div id="outline-container-1.65.9" class="outline-4">
<h4 id="sec-1.65.9"><span class="todo STARTED"> STARTED</span> SQL </h4>
<div class="outline-text-4" id="text-1.65.9">

<p>Things left to do
</p><ul>
<li>
support for sessions
</li>
<li>
add more useful header arguments (user, passwd, database, etc&hellip;)
</li>
<li>
support for more engines (currently only supports mysql)
</li>
<li>
what's a reasonable way to drop table data into SQL?


</li>
</ul>


<div class="org-src-container"><label class="org-src-name">sql-example()</label><pre class="src src-sql">
show databases
</pre></div>




<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" />
</colgroup>
<tbody>
<tr><td>"Database"</td></tr>
<tr><td>"information<sub>schema</sub>"</td></tr>
<tr><td>"test"</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1.65.10" class="outline-4">
<h4 id="sec-1.65.10"><span class="done DONE"> DONE</span> SASS </h4>
<div class="outline-text-4" id="text-1.65.10">

<p>Sass is a very nice extension of CSS, which is much nicer to read and
write (see <a href="http://sass-lang.com/">sass-lang</a>).
</p>



<div class="org-src-container"><label class="org-src-name">sass-example()</label><pre class="src src-sass">
<span class="org-keyword">#me</span>
  <span class="org-constant">position:</span> absolute
  <span class="org-constant">top:</span> 1em
  <span class="org-constant">left:</span> 1em
  <span class="org-type">.head</span>
    <span class="org-constant">text-align:</span> center
</pre></div>




<p>
<a href="stylesheet.css">stylesheet.css</a>
</p>
</div>

</div>

<div id="outline-container-1.65.11" class="outline-4">
<h4 id="sec-1.65.11"><span class="done DONE"> DONE</span> CSS </h4>
<div class="outline-text-4" id="text-1.65.11">

<p>trivial <a href="lisp/langs/org-babel-css.el">org-babel-css.el</a>
</p>
</div>

</div>

<div id="outline-container-1.65.12" class="outline-4">
<h4 id="sec-1.65.12"><span class="done DONE"> DONE</span> ditaa </h4>
<div class="outline-text-4" id="text-1.65.12">

<p>(see <a href="#sec-1.53.2">file result types</a>)
</p>


<p>
<img src="blue.png"  alt="blue.png" />
</p>
</div>

</div>

<div id="outline-container-1.65.13" class="outline-4">
<h4 id="sec-1.65.13"><span class="done DONE"> DONE</span> latex </h4>
<div class="outline-text-4" id="text-1.65.13">

<ul>
<li>
State "DONE"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2010-03-01 Mon 10:27</span></span>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.65.14" class="outline-4">
<h4 id="sec-1.65.14"><span class="done DONE"> DONE</span> gnuplot [7/7] </h4>
<div class="outline-text-4" id="text-1.65.14">

<p>(see <a href="#sec-1.53.2">file result types</a>)
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" /><col align="right" />
</colgroup>
<thead>
<tr><th scope="col">independent var</th><th scope="col">first dependent var</th><th scope="col">second dependent var</th></tr>
</thead>
<tbody>
<tr><td>0.1</td><td>0.425</td><td>0.375</td></tr>
<tr><td>0.2</td><td>0.3125</td><td>0.3375</td></tr>
<tr><td>0.3</td><td>0.24999993</td><td>0.28333338</td></tr>
<tr><td>0.4</td><td>0.275</td><td>0.28125</td></tr>
<tr><td>0.5</td><td>0.26</td><td>0.27</td></tr>
<tr><td>0.6</td><td>0.25833338</td><td>0.24999993</td></tr>
<tr><td>0.7</td><td>0.24642845</td><td>0.23928553</td></tr>
<tr><td>0.8</td><td>0.23125</td><td>0.2375</td></tr>
<tr><td>0.9</td><td>0.23333323</td><td>0.2333332</td></tr>
<tr><td>1</td><td>0.2225</td><td>0.22</td></tr>
<tr><td>1.1</td><td>0.20909075</td><td>0.22272708</td></tr>
<tr><td>1.2</td><td>0.19999998</td><td>0.21458333</td></tr>
<tr><td>1.3</td><td>0.19615368</td><td>0.21730748</td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">implementing-gnuplot(data=gnuplot-data)</label><pre class="src src-gnuplot">
<span class="org-constant">set</span> <span class="org-type">title</span> "Implementing Gnuplot"
<span class="org-keyword">plot</span> <span class="org-variable-name">data</span> <span class="org-type">using</span> 1:2 <span class="org-type">with</span> <span class="org-function-name">lines</span>
</pre></div>




<ul>
<li id="sec-1.65.14.1"><span class="done DONE"> DONE</span> add variables <br/>
gnuplot 4.2 and up support user defined variables.  This is how
we will handle variables with org-babel (meaning we will need to
require gnuplot 4.2 and up for variable support, which can be
install using <a href="http://www.macports.org/install.php">macports</a> on Mac OSX).

<ul>
<li>
scalar variables should be replaced in the body of the gnuplot code
</li>
<li>
vector variables should be exported to tab-separated files, and
the variable names should be replaced with the path to the files

</li>
</ul>
</li>
<li id="sec-1.65.14.2"><span class="done DONE"> DONE</span> direct plotting w/o session <br/>
</li>
<li id="sec-1.65.14.3"><span class="done DEFERRED"> DEFERRED</span> gnuplot support for column/row names <br/>
This should be implemented along the lines of the <a href="#*==STARTED==Column==(and==row)==names==of==tables==in==R==input/output">R-colname-support</a>.

<p>
We can do something similar to the :labels param in org-plot, we just
have to be careful to ensure that each label is aligned with the
related data file.
</p>
<p>
This may be walking too close to an entirely prebuilt plotting tool
rather than straight gnuplot code evaluation.  For now I think this
can wait.
</p>
</li>
<li id="sec-1.65.14.4"><span class="done DONE"> DONE</span> a <code>file</code> header argument <br/>
to specify a file holding the results




<div class="org-src-container"><label class="org-src-name">gnuplot-to-file-implementation(data=gnuplot-data)</label><pre class="src src-gnuplot">
<span class="org-keyword">plot</span> <span class="org-variable-name">data</span> <span class="org-type">using</span> 1:2, data <span class="org-type">using</span> 1:3 <span class="org-type">with</span> <span class="org-function-name">lines</span>
</pre></div>




<p>
<a href="plot.png"><img src="plot.png"/></a>
</p>
</li>
<li id="sec-1.65.14.5"><span class="done DONE"> DONE</span> helpers from org-plot.el <br/>
There are a variety of helpers in org-plot which can be fit nicely
into custom gnuplot header arguments.

<p>
These should all be in place by now.
</p>
</li>
<li id="sec-1.65.14.6"><span class="done DEFERRED"> DEFERRED</span> header argument specifying 3D data <br/>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="right" /><col align="right" /><col align="right" /><col align="right" /><col align="right" /><col align="right" /><col align="right" /><col align="left" /><col align="left" /><col align="left" /><col align="left" /><col align="left" /><col align="left" /><col align="left" /><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>1</td><td>1</td><td>0</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
</tbody>
</table>





<div class="org-src-container"><label class="org-src-name">implementing-gnuplot-grid-plots()</label><pre class="src src-gnuplot">
<span class="org-comment">#+END_SRC</span>


**** DONE gnuplot sessions
Working on this, we won<span class="org-string">'t support multiple sessions as `gnuplot-mode'</span>
isn<span class="org-string">'t setup for such things.</span>

Also we can<span class="org-string">'t display results with the default :none session, so for</span>
gnuplot we really want the default behavior to be :default, and to
only run a :none session when explicitly specified.

<span class="org-comment">#+srcname: implementing-gnuplot-sessions</span>
<span class="org-comment">#+BEGIN_SRC gnuplot </span>
<span class="org-constant">set</span> <span class="org-type">title</span> "Implementing Gnuplot Sessions"
<span class="org-keyword">plot</span> <span class="org-variable-name">data</span> <span class="org-type">using</span> 1:2 <span class="org-type">with</span> <span class="org-function-name">lines</span>
</pre></div>




<p>
<a href="session.png"><img src="session.png"/></a>
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-1.65.15" class="outline-4">
<h4 id="sec-1.65.15"><span class="done DONE"> DONE</span> dot </h4>
<div class="outline-text-4" id="text-1.65.15">

<p>(see <a href="#sec-1.53.2">file result types</a>)
</p>


<p>
<img src="test-dot.png"  alt="test-dot.png" />
<a href="test-dot.png"><img src="test-dot.png"/></a>
</p>
</div>

</div>

<div id="outline-container-1.65.16" class="outline-4">
<h4 id="sec-1.65.16"><span class="done DONE"> DONE</span> asymptote </h4>
<div class="outline-text-4" id="text-1.65.16">

<p>(see <a href="#sec-1.53.2">file result types</a>)
</p>
<p>
for information on asymptote see <a href="http://asymptote.sourceforge.net">http://asymptote.sourceforge.net</a>
</p>


<p>
<img src="asymptote-test.png"  alt="asymptote-test.png" />
</p>
</div>

</div>

<div id="outline-container-1.65.17" class="outline-4">
<h4 id="sec-1.65.17"><span class="done DONE"> DONE</span> ruby </h4>
<div class="outline-text-4" id="text-1.65.17">

</div>

</div>

<div id="outline-container-1.65.18" class="outline-4">
<h4 id="sec-1.65.18"><span class="done DONE"> DONE</span> python </h4>
<div class="outline-text-4" id="text-1.65.18">

</div>

</div>

<div id="outline-container-1.65.19" class="outline-4">
<h4 id="sec-1.65.19"><span class="done DONE"> DONE</span> R </h4>
<div class="outline-text-4" id="text-1.65.19">

</div>

</div>

<div id="outline-container-1.65.20" class="outline-4">
<h4 id="sec-1.65.20"><span class="done DONE"> DONE</span> emacs-lisp </h4>
<div class="outline-text-4" id="text-1.65.20">

</div>

</div>

<div id="outline-container-1.65.21" class="outline-4">
<h4 id="sec-1.65.21"><span class="done DONE"> DONE</span> sh </h4>
<div class="outline-text-4" id="text-1.65.21">



</div>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn.1" href="#fnr.1">1</a></sup> 3
&gt; df &lt;- data.frame(var1=1:26, var2=26:1, row.names=letters)
&gt; df$var2
 [1] 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10  9  8  7  6  5  4  3  2  1
&gt; df["g",]
  var1 var2
g    7   20
</pre>

</p>
</div>
</div>
