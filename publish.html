---
layout: default
title: publish
---


<p>This file contains the code to export this repo for publishing on github
</p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Index </h2>
<div class="outline-text-2" id="text-1">

<p>Export the index in a manner amenable to <a href="http://jekyllrb.com/">jekyll</a> processing.  This code
exports single files for processing by jekyll and could easily be
reused in other projects.
</p>


<pre class="src src-emacs-lisp">(mapc
 (<span style="color: #afeeee; font-weight: bold;">lambda</span> (file)
   (<span style="color: #afeeee; font-weight: bold;">let</span> ((full-file (expand-file-name
                     (concat file <span style="color: #87cefa;">".org"</span>)
                     (file-name-directory (buffer-file-name))))
         (yaml-front-matter `((<span style="color: #87cefa;">"layout"</span> . <span style="color: #87cefa;">"default"</span>)
                              (<span style="color: #87cefa;">"title"</span> . ,file)))
         html)
     <span style="color: #add8e6;">;; </span><span style="color: #add8e6;">go to the top level tasks heading
</span>     (find-file full-file)
     (setq html (org-export-as-html nil nil nil 'string t nil))
     (<span style="color: #afeeee; font-weight: bold;">with-temp-file</span> (concat file <span style="color: #87cefa;">".html"</span>)
       (<span style="color: #afeeee; font-weight: bold;">when</span> yaml-front-matter
         (insert <span style="color: #87cefa;">"---\n"</span>)
         (mapc (<span style="color: #afeeee; font-weight: bold;">lambda</span> (pair) (insert (format <span style="color: #87cefa;">"%s: %s\n"</span> (car pair) (cdr pair))))
               yaml-front-matter)
         (insert <span style="color: #87cefa;">"---\n\n"</span>))
       (insert html)))) '(<span style="color: #87cefa;">"index"</span> <span style="color: #87cefa;">"publish"</span> <span style="color: #87cefa;">"dev-updates"</span>))
</pre>




</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Development Updates </h2>
<div class="outline-text-2" id="text-2">

<p>This code will be used to publish posts for all Task and Bug items
which have an associated date/time.  This generates one blog post per
headline and could easily be adapted for managing a blog through
org-mode.
</p>


<pre class="src src-emacs-lisp">(<span style="color: #afeeee; font-weight: bold;">save-excursion</span>
  <span style="color: #add8e6;">;; </span><span style="color: #add8e6;">map over all tasks entries
</span>  (<span style="color: #afeeee; font-weight: bold;">let</span> ((dev-file (expand-file-name
                   <span style="color: #87cefa;">"development.org"</span>
                   (file-name-directory (buffer-file-name))))
        (posts-dir (expand-file-name
                    <span style="color: #87cefa;">"_posts"</span>
                    (file-name-directory (buffer-file-name))))
        (yaml-front-matter '((<span style="color: #87cefa;">"layout"</span> . <span style="color: #87cefa;">"default"</span>))))
    <span style="color: #add8e6;">;; </span><span style="color: #add8e6;">go through both the tasks and bugs
</span>    (mapc
     (<span style="color: #afeeee; font-weight: bold;">lambda</span> (top-level)
       (find-file dev-file)
       (goto-char (point-min))
       (org-shifttab)
       (outline-next-visible-heading top-level)
       (org-show-subtree)
       (org-map-tree
        (<span style="color: #afeeee; font-weight: bold;">lambda</span> ()
          (<span style="color: #afeeee; font-weight: bold;">let*</span> ((props (org-entry-properties))
                 (todo (cdr (assoc <span style="color: #87cefa;">"TODO"</span> props)))
                 (time (cdr (assoc <span style="color: #87cefa;">"TIMESTAMP_IA"</span> props))))
            <span style="color: #add8e6;">;; </span><span style="color: #add8e6;">each task with a state and timestamp can be exported as a
</span>            <span style="color: #add8e6;">;; </span><span style="color: #add8e6;">jekyll blog post
</span>            (<span style="color: #afeeee; font-weight: bold;">when</span> (and todo time)
              (message <span style="color: #87cefa;">"time=%s"</span> time)
              (<span style="color: #afeeee; font-weight: bold;">let*</span> ((heading (org-get-heading))
                     (title (replace-regexp-in-string
                             <span style="color: #87cefa;">"[:=\(\)\?]"</span> <span style="color: #87cefa;">""</span>
                             (replace-regexp-in-string
                              <span style="color: #87cefa;">"[ \t]"</span> <span style="color: #87cefa;">"-"</span> heading)))
                     (str-time (and (string-match <span style="color: #87cefa;">"</span><span style="color: #87cefa; font-weight: bold;">\\</span><span style="color: #87cefa; font-weight: bold;">(</span><span style="color: #87cefa;">[[:digit:]\-]+</span><span style="color: #87cefa; font-weight: bold;">\\</span><span style="color: #87cefa; font-weight: bold;">)</span><span style="color: #87cefa;"> "</span> time)
                                    (match-string 1 time)))
                     (to-file (format <span style="color: #87cefa;">"%s-%s.html"</span> str-time title))
                     (org-buffer (current-buffer))
                     (yaml-front-matter (cons (cons <span style="color: #87cefa;">"title"</span> heading) yaml-front-matter))
                     html)
                (org-narrow-to-subtree)
                (<span style="color: #afeeee; font-weight: bold;">let</span> ((level (- (org-outline-level) 1))
                      (contents (buffer-substring (point-min) (point-max))))
                  (<span style="color: #afeeee; font-weight: bold;">dotimes</span> (n level nil) (org-promote-subtree))
                  (setq html (org-export-as-html nil nil nil 'string t nil))
                  (set-buffer org-buffer)
                  (delete-region (point-min) (point-max))
                  (insert contents)
                  (save-buffer))
                (widen)
                (<span style="color: #afeeee; font-weight: bold;">with-temp-file</span> (expand-file-name to-file posts-dir)
                  (<span style="color: #afeeee; font-weight: bold;">when</span> yaml-front-matter
                    (insert <span style="color: #87cefa;">"---\n"</span>)
                    (mapc (<span style="color: #afeeee; font-weight: bold;">lambda</span> (pair) (insert (format <span style="color: #87cefa;">"%s: %s\n"</span> (car pair) (cdr pair))))
                          yaml-front-matter)
                    (insert <span style="color: #87cefa;">"---\n\n"</span>))
                  (insert html))
                (get-buffer org-buffer)))))))
     '(1 2))))
</pre>



</div>
</div>
